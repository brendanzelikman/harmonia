import{eV as Js,eW as er,eX as tr,eY as nr,eZ as or,e_ as me,e$ as Le,f0 as sr,f1 as rr,f2 as cr,f3 as ar,f4 as ir,f5 as lr,f6 as dr,f7 as ko,dC as Ue,f8 as cn,ao as ur,bD as fr,f9 as jn,fa as Yn,fb as wo,fc as xo,fd as ve,fe as an,ff as Co,dD as bo,dE as ln,fg as po,fh as wt,eF as To,fi as yo,fj as gr,fk as mr,fl as hr,r as I,e as z,j as c,N as de,bz as yt,aP as kr,aQ as wr,aR as xr,dS as Me,fm as Cr,dB as he,fn as br,fo as Yt,dQ as So,dX as vo,dR as Io,K as Ro,bF as le,aq as Do,dG as pr,dH as Tr,fp as yr,y as Ut,fq as Eo,fr as No,fs as Xt,ft as Zt,w as dn,x as $o,fu as Sr,fv as Xn,fw as vr,fx as Ir,fy as Rr,a as X,fz as Mo,R as J,a8 as un,fA as Dr,ac as Er,fB as Nr,fC as Zn,b as $r,fD as Mr,aK as Ve,ax as Lo,fE as Lr,fF as Pr,s as fn,a0 as Ge,a1 as gn,a3 as mn,fG as Po,fH as Ao,T as Ar,fI as Hr,fJ as Br,fK as zr,fL as Qt,fM as Fr,au as Or,fN as Wr,fO as Ho,fP as xt,fQ as Jt,fR as hn,fS as Kr,fT as Vr,fU as _r,fV as St,fW as Ct,fX as ye,aV as Ke,fY as Ur,fZ as Gr,ar as Bo,Y as qr,ap as zo,f_ as bt,f$ as jr,g0 as Yr,o as Xr,g1 as Zr,g2 as Qr,aa as kn,g3 as Jr,g4 as wn,ad as ec,g5 as Fo,g6 as tc,g7 as nc,g8 as oc,S as sc,a5 as Oo,a4 as rc,et as Qn,g9 as cc,ga as ac,ah as ic,gb as lc,gc as dc,gd as uc,ge as Se,gf as fc,gg as Jn,gh as en,gi as Wo,gj as gc,u as xn,av as mc,t as hc,f as eo,m as kc,k as wc,ay as xc,J as Cc,gk as bc,gl as pc,gm as Tc,gn as yc,bC as Ko,aD as Sc,aS as to,go as vc,ai as Ic,gp as no,gq as Gt,gr as ft,gs as gt,gt as oo,gu as mt,gv as so,gw as ro,aj as Rc,gx as Dc,af as Ec,gy as Nc,gz as $c}from"./index-fe048463.js";import{c as vt,d as Vo,u as It,a as Cn,m as Mc,e as Lc,C as Pc,f as Ac}from"./ContextMenu-40874058.js";import{e as co,u as _o,o as Hc,f as Bc,s as zc,g as Fc,h as Oc,i as Wc,j as Uo,k as Go,p as qo,l as jo,n as Yo,q as Xo,v as Zo,w as Kc,x as Vc,a as _c,r as Uc,t as Gc,b as qc,c as jc,d as Yc,y as Xc,z as Zc,A as Qc,B as Jc}from"./ArrangementThunks-8e0396f3.js";import{Z as kt}from"./menu-4bb74a08.js";const ao=e=>t=>new Promise(n=>{Le(e)?n(t(vt(e))):n(t(Vo(e)))}),Rt=e=>t=>{e.forEach(n=>{Le(n)?t(To(n)):t(yo(n))})},ea=e=>t=>{e&&(t(tr(e)),t(nr(e)),t(or(e)))},Qo=e=>(t,n)=>{var a;const s=n(),o=me(s,e);if(!o)return;Le(o)?(t(sr(o.id)),t(rr(o.id))):(t(cr(o.id)),t(ar({trackId:o.id,instrumentId:o.instrumentId})),t(ir(o.id))),t(lr(o.id)),t(dr(o.id));const l=((a=ko(s)[o.id])==null?void 0:a.trackIds)??[];for(const u of l)t(Qo(u));Ue(s)===e&&(t(cn(void 0)),t(ur()))},ta=e=>async(t,n)=>{const s=n(),o=ko(s),r=me(s,e),l=fr(o,e);if(!r||!l)return;const i=await t(ao(r));if(!i)return;const a=jn(s,l.clipIds),u=Yn(s,l.transpositionIds),p=a.map(g=>({...g,trackId:i})),b=u.map(g=>({...g,trackId:i}));if(t(co({clips:p,transpositions:b})),!Le(r))return;const d=l.trackIds,x=wo(s),y=async(g,C)=>{g.map(h=>x[h]).forEach(async h=>{var E,O,_;const S=await t(ao({...h,parentId:C})),D=(E=o[h.id])==null?void 0:E.clipIds,N=(O=o[h.id])==null?void 0:O.transpositionIds;if(!D||!N)return;const k=jn(s,D),$=Yn(s,N),M=k.map(U=>({...U,trackId:S})),A=$.map(U=>({...U,trackId:S}));t(co({clips:M,transpositions:A}));const L=(_=o[h.id])==null?void 0:_.trackIds;L&&await y(L,S)})};await y(d,i)},na=e=>(t,n)=>{if(!e)return;const s=n(),o=me(s,e);o&&(t(Rt([{...o,collapsed:!0}])),t(xo([o.id])))},oa=e=>(t,n)=>{const s=n(),o=me(s,e);if(!o||ve(o))return;const r=an(s,o.id);t(Rt(r.map(l=>({...l,collapsed:!0})))),t(xo(r.map(l=>l.id)))},sa=e=>(t,n)=>{const s=n(),o=me(s,e);o&&(t(Rt([{...o,collapsed:!1}])),t(Co([o.id])))},ra=e=>(t,n)=>{const s=n(),o=me(s,e);if(!o||ve(o))return;const r=an(s,o.id);t(Rt(r.map(l=>({...l,collapsed:!1})))),t(Co(r.map(l=>l.id)))},ca=()=>e=>{e(gr())},tn=()=>e=>{e(Js())},aa=()=>e=>{e(mr())},nn=()=>e=>{e(er())},ia=(e,t)=>(n,s)=>{const o=s(),r=bo(o,t);if(!r)return;const{instrumentId:l}=r,i=ln(o,l);if(i){if(!e||!po(e.nativeEvent)){const a={mute:!i.mute};n(wt({instrumentId:l,update:a}));return}n(i.mute?tn():ca())}},la=(e,t)=>(n,s)=>{const o=s(),r=bo(o,t);if(!r)return;const{instrumentId:l}=r,i=ln(o,l);if(i){if(!e||!po(e.nativeEvent)){const a={solo:!i.solo};n(wt({instrumentId:l,update:a}));return}n(i.solo?nn():aa())}};var on={exports:{}};function Jo(e){var t,n,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=Jo(e[t]))&&(s&&(s+=" "),s+=n);else for(t in e)e[t]&&(s&&(s+=" "),s+=t);return s}function io(){for(var e,t,n=0,s="";n<arguments.length;)(e=arguments[n++])&&(t=Jo(e))&&(s&&(s+=" "),s+=t);return s}on.exports=io,on.exports.clsx=io;var da=on.exports;const Ce=hr(da),ua="c1wupbe7-0-0-beta-22",fa=`rdg-cell ${ua}`,ga="cd0kgiy7-0-0-beta-22",ma=`rdg-cell-frozen ${ga}`,ha="c1730fa47-0-0-beta-22",ka=`rdg-cell-frozen-last ${ha}`,wa="r104f42s7-0-0-beta-22",xa=`rdg ${wa}`,Ca="v7ly7s7-0-0-beta-22",ba=`rdg-viewport-dragging ${Ca}`,pa="fc4f4zb7-0-0-beta-22",Ta="r1otpg647-0-0-beta-22",bn=`rdg-row ${Ta}`,ya="rel5gk27-0-0-beta-22",Dt="rdg-row-selected",Sa="r1qymf1z7-0-0-beta-22",va="c8rwwhf7-0-0-beta-22",Ia=`rdg-checkbox-label ${va}`,Ra="c1rb4brs7-0-0-beta-22",Da=`rdg-checkbox-input ${Ra}`,Ea="c1bvvwcc7-0-0-beta-22",Na=`rdg-checkbox ${Ea}`,$a="c1yg790j7-0-0-beta-22",Ma=`rdg-checkbox-label-disabled ${$a}`;function La({onChange:e,...t},n){function s(o){e(o.target.checked,o.nativeEvent.shiftKey)}return z("label",{className:Ce(Ia,t.disabled&&Ma),children:[c("input",{type:"checkbox",ref:n,...t,className:Da,onChange:s}),c("div",{className:Na})]})}const pt=typeof window>"u"?I.useEffect:I.useLayoutEffect;function es(e){const t=I.useRef(null);return pt(()=>{var n;e&&((n=t.current)==null||n.focus({preventScroll:!0}))},[e]),{ref:t,tabIndex:e?0:-1}}const ts=I.createContext(void 0),Pa=ts.Provider;function ns(){return I.useContext(ts)}function Aa(e){try{return c(de,{children:e.row[e.column.key]})}catch{return null}}const Ha="gb8l2vs7-0-0-beta-22",Ba=`rdg-group-cell-content ${Ha}`,za="c1ggynjl7-0-0-beta-22",Fa=`rdg-caret ${za}`;function Oa(e){return c(Wa,{...e})}function Wa({groupKey:e,isExpanded:t,isCellSelected:n,toggleGroup:s}){const{ref:o,tabIndex:r}=es(n);function l({key:a}){a==="Enter"&&s()}return z("span",{ref:o,className:Ba,tabIndex:r,onKeyDown:l,children:[e,c("svg",{viewBox:"0 0 14 8",width:"14",height:"8",className:Fa,"aria-hidden":!0,children:c("path",{d:t?"M1 1 L 7 7 L 13 1":"M1 7 L 7 1 L 13 7"})})]})}const Ka=I.createContext(void 0),os=Ka.Provider,Va=I.createContext(void 0),_a=Va.Provider,sn="select-row";function ae(e,t,n){const s=typeof e.colSpan=="function"?e.colSpan(n):1;if(Number.isInteger(s)&&s>1&&(!e.frozen||e.idx+s-1<=t))return s}function rn(e){e==null||e.scrollIntoView({inline:"nearest",block:"nearest"})}const Ua=new Set(["Unidentified","Alt","AltGraph","CapsLock","Control","Fn","FnLock","Meta","NumLock","ScrollLock","Shift","Tab","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home","PageDown","PageUp","Insert","ContextMenu","Escape","Pause","Play","PrintScreen","F1","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"]);function lo(e){return(e.ctrlKey||e.metaKey)&&e.key!=="Control"}function Ga(e){return!Ua.has(e.key)}function qa({key:e,target:t}){return e==="Tab"&&(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)?t.matches(".rdg-editor-container > :only-child, .rdg-editor-container > label:only-child > :only-child, .rdg-editor-container > div:only-child > label:only-child > :only-child"):!1}const ja="m1l09lto7-0-0-beta-22";function Ya(e){return c(de,{children:e.map(({key:t,idx:n,minWidth:s,maxWidth:o})=>c("div",{className:ja,style:{gridColumnStart:n+1,minWidth:s,maxWidth:o},"data-measuring-cell-key":t},t))})}function Xa({selectedPosition:e,columns:t,rows:n,isGroupRow:s}){const o=t[e.idx],r=n[e.rowIdx];return!s(r)&&ss(o,r)}function ss(e,t){return e.editor!=null&&!e.rowGroup&&(typeof e.editable=="function"?e.editable(t):e.editable)!==!1}function rs({rows:e,topSummaryRows:t,bottomSummaryRows:n,rowIdx:s,lastFrozenColumnIndex:o,column:r,isGroupRow:l}){const i=(t==null?void 0:t.length)??0,a=-1-i;if(s===a)return ae(r,o,{type:"HEADER"});if(t&&s>a&&s<=i+a)return ae(r,o,{type:"SUMMARY",row:t[s+i]});if(s>=0&&s<e.length){const u=e[s];return l(u)?void 0:ae(r,o,{type:"ROW",row:u})}if(n)return ae(r,o,{type:"SUMMARY",row:n[s-e.length]})}function Za({cellNavigationMode:e,columns:t,colSpanColumns:n,rows:s,topSummaryRows:o,bottomSummaryRows:r,minRowIdx:l,maxRowIdx:i,currentPosition:{idx:a},nextPosition:u,lastFrozenColumnIndex:p,isCellWithinBounds:b,isGroupRow:m}){let{idx:d,rowIdx:x}=u;const y=g=>{if(x>=0&&x<s.length){const C=s[x];if(m(C))return}for(const C of n){const w=C.idx;if(w>d)break;const h=rs({rows:s,topSummaryRows:o,bottomSummaryRows:r,rowIdx:x,lastFrozenColumnIndex:p,column:C,isGroupRow:m});if(h&&d>w&&d<h+w){d=w+(g?h:0);break}}};if(b(u)&&y(d-a>0),e!=="NONE"){const g=t.length;d===g?e==="CHANGE_ROW"?x===i||(d=0,x+=1):d=0:d===-1&&(e==="CHANGE_ROW"?x===l||(x-=1,d=g-1):d=g-1,y(!1))}return{idx:d,rowIdx:x}}function Qa({cellNavigationMode:e,maxColIdx:t,minRowIdx:n,maxRowIdx:s,selectedPosition:{rowIdx:o,idx:r},shiftKey:l}){return e==="NONE"||e==="CHANGE_ROW"?l?r===0&&o===n:r===t&&o===s:!1}function Et(e,t){return t!==void 0?{"--rdg-grid-row-start":e,"--rdg-row-height":`${t}px`}:{"--rdg-grid-row-start":e}}function qe(e,t){return{gridColumnStart:e.idx+1,gridColumnEnd:t!==void 0?`span ${t}`:void 0,insetInlineStart:e.frozen?`var(--rdg-frozen-left-${e.idx})`:void 0}}function je(e,...t){return Ce(fa,...t,e.frozen&&ma,e.isLastFrozenColumn&&ka)}const{min:_e,max:Tt,round:Cd,floor:uo,sign:Ja,abs:ei}=Math;function qt(e){if(typeof e!="function")throw new Error("Please specify the rowKeyGetter prop to use selection")}function ti(e,{minWidth:t,maxWidth:n}){return e=Tt(e,t),typeof n=="number"&&n>=t?_e(e,n):e}const ni="auto",oi=80;function si({rawColumns:e,columnWidths:t,viewportWidth:n,scrollLeft:s,defaultColumnOptions:o,rawGroupBy:r,enableVirtualization:l}){const i=(o==null?void 0:o.width)??ni,a=(o==null?void 0:o.minWidth)??oi,u=(o==null?void 0:o.maxWidth)??void 0,p=(o==null?void 0:o.formatter)??Aa,b=(o==null?void 0:o.sortable)??!1,m=(o==null?void 0:o.resizable)??!1,{columns:d,colSpanColumns:x,lastFrozenColumnIndex:y,groupBy:g}=I.useMemo(()=>{const k=[];let $=-1;const M=e.map(v=>{const L=(r==null?void 0:r.includes(v.key))??!1,E=L||v.frozen||!1,O={...v,idx:0,frozen:E,isLastFrozenColumn:!1,rowGroup:L,width:v.width??i,minWidth:v.minWidth??a,maxWidth:v.maxWidth??u,sortable:v.sortable??b,resizable:v.resizable??m,formatter:v.formatter??p};return L&&(O.groupFormatter??(O.groupFormatter=Oa)),E&&$++,O});M.sort(({key:v,frozen:L},{key:E,frozen:O})=>v===sn?-1:E===sn?1:r!=null&&r.includes(v)?r.includes(E)?r.indexOf(v)-r.indexOf(E):-1:r!=null&&r.includes(E)?1:L?O?0:-1:O?1:0);const A=[];return M.forEach((v,L)=>{v.idx=L,v.rowGroup&&k.push(v.key),v.colSpan!=null&&A.push(v)}),$!==-1&&(M[$].isLastFrozenColumn=!0),{columns:M,colSpanColumns:A,lastFrozenColumnIndex:$,groupBy:k}},[e,i,a,u,p,m,b,r]),{templateColumns:C,layoutCssVars:w,totalFrozenColumnWidth:h,columnMetrics:S}=I.useMemo(()=>{const k=new Map;let $=0,M=0;const A=[];for(const L of d){let E=t.get(L.key)??L.width;typeof E=="number"?E=ti(E,L):E=L.minWidth,A.push(`${E}px`),k.set(L,{width:E,left:$}),$+=E}if(y!==-1){const L=k.get(d[y]);M=L.left+L.width}const v={gridTemplateColumns:A.join(" ")};for(let L=0;L<=y;L++){const E=d[L];v[`--rdg-frozen-left-${E.idx}`]=`${k.get(E).left}px`}return{templateColumns:A,layoutCssVars:v,totalFrozenColumnWidth:M,columnMetrics:k}},[t,d,y]),[D,N]=I.useMemo(()=>{if(!l)return[0,d.length-1];const k=s+h,$=s+n,M=d.length-1,A=_e(y+1,M);if(k>=$)return[A,A];let v=A;for(;v<M;){const{left:_,width:U}=S.get(d[v]);if(_+U>k)break;v++}let L=v;for(;L<M;){const{left:_,width:U}=S.get(d[L]);if(_+U>=$)break;L++}const E=Tt(A,v-1),O=_e(M,L+1);return[E,O]},[S,d,y,s,h,n,l]);return{columns:d,colSpanColumns:x,colOverscanStartIdx:D,colOverscanEndIdx:N,templateColumns:C,layoutCssVars:w,columnMetrics:S,lastFrozenColumnIndex:y,totalFrozenColumnWidth:h,groupBy:g}}function ri(){const e=I.useRef(null),[t,n]=I.useState(1),[s,o]=I.useState(1),[r,l]=I.useState(!1);return pt(()=>{const{ResizeObserver:i}=window;if(i==null)return;const{clientWidth:a,clientHeight:u,offsetWidth:p,offsetHeight:b}=e.current,{width:m,height:d}=e.current.getBoundingClientRect(),x=m-p+a,y=d-b+u;n(x),o(y),l(!0);const g=new i(C=>{const w=C[0].contentBoxSize[0];n(w.inlineSize),o(w.blockSize)});return g.observe(e.current),()=>{g.disconnect()}},[]),[e,t,s,r]}function te(e){const t=I.useRef(e);I.useEffect(()=>{t.current=e});const n=I.useCallback((...s)=>{t.current(...s)},[]);return e&&n}function Nt(e,t){const[n,s]=I.useState(!1);n&&!e&&s(!1);const o=I.useCallback(i=>{if(i!==null&&(rn(i),!i.contains(document.activeElement))){if(t!=null&&t.current){t.current=!1;return}i.focus({preventScroll:!0})}},[t]);function r(i){i.target!==i.currentTarget&&s(!0)}return{ref:e?o:void 0,tabIndex:e&&!n?0:-1,onFocus:e?r:void 0}}function ci({columns:e,colSpanColumns:t,rows:n,topSummaryRows:s,bottomSummaryRows:o,colOverscanStartIdx:r,colOverscanEndIdx:l,lastFrozenColumnIndex:i,rowOverscanStartIdx:a,rowOverscanEndIdx:u,columnWidths:p,isGroupRow:b}){const m=I.useMemo(()=>{if(r===0)return 0;let g=r;const C=(w,h)=>h!==void 0&&w+h>r?(g=w,!0):!1;for(const w of t){const h=w.idx;if(h>=g||C(h,ae(w,i,{type:"HEADER"})))break;for(let S=a;S<=u;S++){const D=n[S];if(!b(D)&&C(h,ae(w,i,{type:"ROW",row:D})))break}if(s!=null){for(const S of s)if(C(h,ae(w,i,{type:"SUMMARY",row:S})))break}if(o!=null){for(const S of o)if(C(h,ae(w,i,{type:"SUMMARY",row:S})))break}}return g},[a,u,n,s,o,r,i,t,b]),{viewportColumns:d,flexWidthViewportColumns:x}=I.useMemo(()=>{const g=[],C=[];for(let w=0;w<=l;w++){const h=e[w];w<m&&!h.frozen||(g.push(h),typeof h.width=="string"&&C.push(h))}return{viewportColumns:g,flexWidthViewportColumns:C}},[m,l,e]),y=I.useMemo(()=>x.filter(g=>!p.has(g.key)),[x,p]);return{viewportColumns:d,flexWidthViewportColumns:y}}function ai(e){return Array.isArray(e)}function ii({rawRows:e,rowHeight:t,clientHeight:n,scrollTop:s,groupBy:o,rowGrouper:r,expandedGroupIds:l,enableVirtualization:i}){const[a,u]=I.useMemo(()=>{if(o.length===0||r==null)return[void 0,e.length];const h=(S,[D,...N],k)=>{let $=0;const M={};for(const[A,v]of Object.entries(r(S,D))){const[L,E]=N.length===0?[v,v.length]:h(v,N,k+$+1);M[A]={childRows:v,childGroups:L,startRowIndex:k+$},$+=E+1}return[M,$]};return h(e,o,0)},[o,r,e]),[p,b]=I.useMemo(()=>{const h=new Set;if(!a)return[e,N];const S=[],D=(k,$,M)=>{if(ai(k)){S.push(...k);return}Object.keys(k).forEach((A,v,L)=>{const E=$!==void 0?`${$}__${A}`:A,O=(l==null?void 0:l.has(E))??!1,{childRows:_,childGroups:U,startRowIndex:oe}=k[A],ie={id:E,parentId:$,groupKey:A,isExpanded:O,childRows:_,level:M,posInSet:v,startRowIndex:oe,setSize:L.length};S.push(ie),h.add(ie),O&&D(U,E,M+1)})};return D(a,void 0,0),[S,N];function N(k){return h.has(k)}},[l,a,e]),{totalRowHeight:m,gridTemplateRows:d,getRowTop:x,getRowHeight:y,findRowIdx:g}=I.useMemo(()=>{if(typeof t=="number")return{totalRowHeight:t*p.length,gridTemplateRows:` repeat(${p.length}, ${t}px)`,getRowTop:k=>k*t,getRowHeight:()=>t,findRowIdx:k=>uo(k/t)};let h=0,S=" ";const D=p.map(k=>{const $=b(k)?t({type:"GROUP",row:k}):t({type:"ROW",row:k}),M={top:h,height:$};return S+=`${$}px `,h+=$,M}),N=k=>Tt(0,_e(p.length-1,k));return{totalRowHeight:h,gridTemplateRows:S,getRowTop:k=>D[N(k)].top,getRowHeight:k=>D[N(k)].height,findRowIdx(k){let $=0,M=D.length-1;for(;$<=M;){const A=$+uo((M-$)/2),v=D[A].top;if(v===k)return A;if(v<k?$=A+1:v>k&&(M=A-1),$>M)return M}return 0}}},[b,t,p]);let C=0,w=p.length-1;if(i){const S=g(s),D=g(s+n);C=Tt(0,S-4),w=_e(p.length-1,D+4)}return{rowOverscanStartIdx:C,rowOverscanEndIdx:w,rows:p,rowsCount:u,totalRowHeight:m,gridTemplateRows:d,isGroupRow:b,getRowTop:x,getRowHeight:y,findRowIdx:g}}const li="h1e8ezgp7-0-0-beta-22",di=`rdg-header-sort-cell ${li}`,ui="h1rrblhe7-0-0-beta-22",fi=`rdg-header-sort-name ${ui}`;function gi({column:e,sortDirection:t,priority:n,onSort:s,isCellSelected:o}){return e.sortable?c(mi,{onSort:s,sortDirection:t,priority:n,isCellSelected:o,children:e.name}):c(de,{children:e.name})}function mi({onSort:e,sortDirection:t,priority:n,children:s,isCellSelected:o}){const r=ns().sortStatus,{ref:l,tabIndex:i}=es(o);function a(p){(p.key===" "||p.key==="Enter")&&(p.preventDefault(),e(p.ctrlKey||p.metaKey))}function u(p){e(p.ctrlKey||p.metaKey)}return z("span",{ref:l,tabIndex:i,className:di,onClick:u,onKeyDown:a,children:[c("span",{className:fi,children:s}),c("span",{children:r({sortDirection:t,priority:n})})]})}const hi="celq7o97-0-0-beta-22",ki=`rdg-cell-resizable ${hi}`;function wi({column:e,colSpan:t,isCellSelected:n,onColumnResize:s,allRowsSelected:o,onAllRowsSelectionChange:r,sortColumns:l,onSortColumnsChange:i,selectCell:a,shouldFocusGrid:u,direction:p}){const b=p==="rtl",{ref:m,tabIndex:d,onFocus:x}=Nt(n),y=l==null?void 0:l.findIndex(v=>v.columnKey===e.key),g=y!==void 0&&y>-1?l[y]:void 0,C=g==null?void 0:g.direction,w=g!==void 0&&l.length>1?y+1:void 0,h=C&&!w?C==="ASC"?"ascending":"descending":void 0,S=je(e,e.headerCellClass,e.resizable&&ki),D=e.headerRenderer??gi;function N(v){if(v.pointerType==="mouse"&&v.buttons!==1)return;const{currentTarget:L,pointerId:E}=v,{right:O,left:_}=L.getBoundingClientRect(),U=b?v.clientX-_:O-v.clientX;if(U>11)return;function oe(ue){ue.preventDefault();const{right:Ie,left:j}=L.getBoundingClientRect(),Q=b?Ie+U-ue.clientX:ue.clientX+U-j;Q>0&&s(e,Q)}function ie(){L.removeEventListener("pointermove",oe),L.removeEventListener("lostpointercapture",ie)}L.setPointerCapture(E),L.addEventListener("pointermove",oe),L.addEventListener("lostpointercapture",ie)}function k(v){if(i==null)return;const{sortDescendingFirst:L}=e;if(g===void 0){const E={columnKey:e.key,direction:L?"DESC":"ASC"};i(l&&v?[...l,E]:[E])}else{let E;if((L===!0&&C==="DESC"||L!==!0&&C==="ASC")&&(E={columnKey:e.key,direction:C==="ASC"?"DESC":"ASC"}),v){const O=[...l];E?O[y]=E:O.splice(y,1),i(O)}else i(E?[E]:[])}}function $(){a(e.idx)}function M(v){const{right:L,left:E}=v.currentTarget.getBoundingClientRect();(b?v.clientX-E:L-v.clientX)>11||s(e,"max-content")}function A(v){x==null||x(v),u&&a(0)}return c("div",{role:"columnheader","aria-colindex":e.idx+1,"aria-selected":n,"aria-sort":h,"aria-colspan":t,ref:m,tabIndex:u?0:d,className:S,style:qe(e,t),onFocus:A,onClick:$,onDoubleClick:e.resizable?M:void 0,onPointerDown:e.resizable?N:void 0,children:D({column:e,sortDirection:C,priority:w,onSort:k,allRowsSelected:o,onAllRowsSelectionChange:r,isCellSelected:n})})}const xi="h197vzie7-0-0-beta-22",Ci=`rdg-header-row ${xi}`;function bi({columns:e,allRowsSelected:t,onAllRowsSelectionChange:n,onColumnResize:s,sortColumns:o,onSortColumnsChange:r,lastFrozenColumnIndex:l,selectedCellIdx:i,selectCell:a,shouldFocusGrid:u,direction:p}){const b=[];for(let m=0;m<e.length;m++){const d=e[m],x=ae(d,l,{type:"HEADER"});x!==void 0&&(m+=x-1),b.push(c(wi,{column:d,colSpan:x,isCellSelected:i===d.idx,onColumnResize:s,allRowsSelected:t,onAllRowsSelectionChange:n,onSortColumnsChange:r,sortColumns:o,selectCell:a,shouldFocusGrid:u&&m===0,direction:p},d.key))}return c("div",{role:"row","aria-rowindex":1,className:Ce(Ci,i===-1&&Dt),style:Et(1),children:b})}const pi=I.memo(bi),Ti="ccpfvsn7-0-0-beta-22",yi=`rdg-cell-copied ${Ti}`,Si="c1bmg16t7-0-0-beta-22",vi=`rdg-cell-dragged-over ${Si}`;function Ii({column:e,colSpan:t,isCellSelected:n,isCopied:s,isDraggedOver:o,row:r,dragHandle:l,skipCellFocusRef:i,onRowClick:a,onRowDoubleClick:u,onRowChange:p,selectCell:b,...m}){const{ref:d,tabIndex:x,onFocus:y}=Nt(n,i),{cellClass:g}=e,C=je(e,typeof g=="function"?g(r):g,s&&yi,o&&vi);function w(k){b(r,e,k)}function h(){var k;w((k=e.editorOptions)==null?void 0:k.editOnClick),a==null||a(r,e)}function S(){w()}function D(){w(!0),u==null||u(r,e)}function N(k){p(e,k)}return c("div",{role:"gridcell","aria-colindex":e.idx+1,"aria-selected":n,"aria-colspan":t,"aria-readonly":!ss(e,r)||void 0,ref:d,tabIndex:x,className:C,style:qe(e,t),onClick:h,onDoubleClick:D,onContextMenu:S,onFocus:y,...m,children:!e.rowGroup&&z(de,{children:[e.formatter({column:e,row:r,isCellSelected:n,onRowChange:N}),l]})})}const Ri=I.memo(Ii);function Di({className:e,rowIdx:t,gridRowStart:n,height:s,selectedCellIdx:o,isRowSelected:r,copiedCellIdx:l,draggedOverCellIdx:i,lastFrozenColumnIndex:a,row:u,viewportColumns:p,selectedCellEditor:b,selectedCellDragHandle:m,skipCellFocusRef:d,onRowClick:x,onRowDoubleClick:y,rowClass:g,setDraggedOverRowIdx:C,onMouseEnter:w,onRowChange:h,selectCell:S,...D},N){const k=te((A,v)=>{h(A,t,v)});function $(A){C==null||C(t),w==null||w(A)}e=Ce(bn,`rdg-row-${t%2===0?"even":"odd"}`,g==null?void 0:g(u),e,o===-1&&Dt);const M=[];for(let A=0;A<p.length;A++){const v=p[A],{idx:L}=v,E=ae(v,a,{type:"ROW",row:u});E!==void 0&&(A+=E-1);const O=o===L;O&&b?M.push(b):M.push(c(Ri,{column:v,colSpan:E,row:u,isCopied:l===L,isDraggedOver:i===L,isCellSelected:O,dragHandle:O?m:void 0,onRowClick:x,onRowDoubleClick:y,onRowChange:k,selectCell:S,skipCellFocusRef:d},v.key))}return c(os,{value:r,children:c("div",{role:"row",ref:N,className:e,onMouseEnter:$,style:Et(n,s),...D,children:M})})}const Ei=I.memo(I.forwardRef(Di));function Ni(e,t){return c(Ei,{...t},e)}function $i({id:e,groupKey:t,childRows:n,isExpanded:s,isCellSelected:o,column:r,row:l,groupColumnIndex:i,toggleGroup:a}){var x;const{ref:u,tabIndex:p,onFocus:b}=Nt(o);function m(){a(e)}const d=r.rowGroup&&i===r.idx;return c("div",{role:"gridcell","aria-colindex":r.idx+1,"aria-selected":o,ref:u,tabIndex:p,className:je(r),style:{...qe(r),cursor:d?"pointer":"default"},onClick:d?m:void 0,onFocus:b,children:(!r.rowGroup||i===r.idx)&&((x=r.groupFormatter)==null?void 0:x.call(r,{groupKey:t,childRows:n,column:r,row:l,isExpanded:s,isCellSelected:o,toggleGroup:m}))},r.key)}const Mi=I.memo($i),Li="gyxx7e97-0-0-beta-22",Pi=`rdg-group-row ${Li}`;function Ai({id:e,groupKey:t,viewportColumns:n,childRows:s,rowIdx:o,row:r,gridRowStart:l,height:i,level:a,isExpanded:u,selectedCellIdx:p,isRowSelected:b,selectGroup:m,toggleGroup:d,...x}){const y=n[0].key===sn?a+1:a;function g(){m(o)}return c(os,{value:b,children:c("div",{role:"row","aria-level":a,"aria-expanded":u,className:Ce(bn,Pi,`rdg-row-${o%2===0?"even":"odd"}`,p===-1&&Dt),onClick:g,style:Et(l,i),...x,children:n.map(C=>c(Mi,{id:e,groupKey:t,childRows:s,isExpanded:u,isCellSelected:p===C.idx,column:C,row:r,groupColumnIndex:y,toggleGroup:d},C.key))})})}const Hi=I.memo(Ai),Bi="s1n3hxke7-0-0-beta-22";function zi({column:e,colSpan:t,row:n,isCellSelected:s,selectCell:o}){var b;const{ref:r,tabIndex:l,onFocus:i}=Nt(s),{summaryCellClass:a}=e,u=je(e,Bi,typeof a=="function"?a(n):a);function p(){o(n,e)}return c("div",{role:"gridcell","aria-colindex":e.idx+1,"aria-colspan":t,"aria-selected":s,ref:r,tabIndex:l,className:u,style:qe(e,t),onClick:p,onFocus:i,children:(b=e.summaryFormatter)==null?void 0:b.call(e,{column:e,row:n,isCellSelected:s})})}const Fi=I.memo(zi),Oi="snfqesz7-0-0-beta-22",Wi="t1jijrjz7-0-0-beta-22",Ki="t14bmecc7-0-0-beta-22",Vi="b1odhhml7-0-0-beta-22",_i=`rdg-summary-row ${Oi}`,Ui=`rdg-top-summary-row ${Wi}`;function Gi({rowIdx:e,gridRowStart:t,row:n,viewportColumns:s,top:o,bottom:r,lastFrozenColumnIndex:l,selectedCellIdx:i,lastTopRowIdx:a,selectCell:u,"aria-rowindex":p}){const b=[];for(let d=0;d<s.length;d++){const x=s[d],y=ae(x,l,{type:"SUMMARY",row:n});y!==void 0&&(d+=y-1);const g=i===x.idx;b.push(c(Fi,{column:x,colSpan:y,row:n,isCellSelected:g,selectCell:u},x.key))}const m=a!==void 0;return c("div",{role:"row","aria-rowindex":p,className:Ce(bn,`rdg-row-${e%2===0?"even":"odd"}`,_i,m?[Ui,a===e&&Ki]:["rdg-bottom-summary-row",e===0&&Vi],i===-1&&Dt),style:{...Et(t),"--rdg-summary-row-top":o!==void 0?`${o}px`:void 0,"--rdg-summary-row-bottom":r!==void 0?`${r}px`:void 0},children:b})}const fo=I.memo(Gi),qi="c1tngyp17-0-0-beta-22";function ji({column:e,colSpan:t,row:n,skipCellFocusRef:s,onRowChange:o,closeEditor:r}){var x,y,g;const l=I.useRef(),i=((x=e.editorOptions)==null?void 0:x.commitOnOutsideClick)!==!1,a=te(()=>{b(!0)}),u=I.useCallback(()=>{s.current=!1,i&&cancelAnimationFrame(l.current)},[i,s]);I.useEffect(()=>{function C(){s.current=!0,i&&(l.current=requestAnimationFrame(a))}return addEventListener("mousedown",C,{capture:!0}),()=>{removeEventListener("mousedown",C,{capture:!0}),u()}},[u,i,a,s]);function p(C){var w;C.key==="Escape"?(C.stopPropagation(),b()):C.key==="Enter"?(C.stopPropagation(),b(!0)):(((w=e.editorOptions)==null?void 0:w.onNavigation)??qa)(C)||C.stopPropagation()}function b(C){C?o(n,!0):r()}const{cellClass:m}=e,d=je(e,"rdg-editor-container",typeof m=="function"?m(n):m,!((y=e.editorOptions)!=null&&y.renderFormatter)&&qi);return c("div",{role:"gridcell","aria-colindex":e.idx+1,"aria-colspan":t,"aria-selected":!0,className:d,style:qe(e,t),onKeyDown:p,onMouseDownCapture:u,children:e.editor!=null&&z(de,{children:[e.editor({column:e,row:n,onRowChange:o,onClose:b}),((g=e.editorOptions)==null?void 0:g.renderFormatter)&&e.formatter({column:e,row:n,isCellSelected:!0,onRowChange:o})]})})}const Yi="cadd3bp7-0-0-beta-22",Xi=`rdg-cell-drag-handle ${Yi}`;function Zi({rows:e,columns:t,selectedPosition:n,latestDraggedOverRowIdx:s,isCellEditable:o,onRowsChange:r,onFill:l,setDragging:i,setDraggedOverRowIdx:a}){function u(d){if(d.buttons!==1)return;i(!0),window.addEventListener("mouseover",x),window.addEventListener("mouseup",y);function x(g){g.buttons!==1&&y()}function y(){window.removeEventListener("mouseover",x),window.removeEventListener("mouseup",y),i(!1),p()}}function p(){const d=s.current;if(d===void 0)return;const{rowIdx:x}=n,y=x<d?x+1:d,g=x<d?d+1:x;m(y,g),a(void 0)}function b(d){d.stopPropagation(),m(n.rowIdx+1,e.length)}function m(d,x){const{idx:y,rowIdx:g}=n,C=t[y],w=e[g],h=[...e],S=[];for(let D=d;D<x;D++)if(o({rowIdx:D,idx:y})){const N=l({columnKey:C.key,sourceRow:w,targetRow:e[D]});N!==e[D]&&(h[D]=N,S.push(D))}S.length>0&&(r==null||r(h,{indexes:S,column:C}))}return c("div",{className:Xi,onMouseDown:u,onDoubleClick:b})}const Qi="a1mygwml7-0-0-beta-22",Ji=`rdg-sort-arrow ${Qi}`;function el({sortDirection:e,priority:t}){return z(de,{children:[tl({sortDirection:e}),nl({priority:t})]})}function tl({sortDirection:e}){return e===void 0?null:c("svg",{viewBox:"0 0 12 8",width:"12",height:"8",className:Ji,"aria-hidden":!0,children:c("path",{d:e==="ASC"?"M0 8 6 0 12 8":"M0 0 6 8 12 0"})})}function nl({priority:e}){return e}function ol(e,t){const{columns:n,rows:s,topSummaryRows:o,bottomSummaryRows:r,rowKeyGetter:l,onRowsChange:i,rowHeight:a,headerRowHeight:u,summaryRowHeight:p,selectedRows:b,onSelectedRowsChange:m,sortColumns:d,onSortColumnsChange:x,defaultColumnOptions:y,groupBy:g,rowGrouper:C,expandedGroupIds:w,onExpandedGroupIdsChange:h,onRowClick:S,onRowDoubleClick:D,onScroll:N,onColumnResize:k,onFill:$,onCopy:M,onPaste:A,cellNavigationMode:v,enableVirtualization:L,renderers:E,className:O,style:_,rowClass:U,direction:oe,"aria-label":ie,"aria-labelledby":ue,"aria-describedby":Ie,"data-testid":j}=e,Q=ns(),ke=a??35,we=u??(typeof ke=="number"?ke:35),q=p??(typeof ke=="number"?ke:35),$t=(E==null?void 0:E.rowRenderer)??(Q==null?void 0:Q.rowRenderer)??Ni,Ye=(E==null?void 0:E.sortStatus)??(Q==null?void 0:Q.sortStatus)??el,Xe=(E==null?void 0:E.checkboxFormatter)??(Q==null?void 0:Q.checkboxFormatter)??La,Ze=(E==null?void 0:E.noRowsFallback)??(Q==null?void 0:Q.noRowsFallback),Pe=v??"NONE",pn=L??!0,Mt=oe??"ltr",Lt=1,Re=(o==null?void 0:o.length)??0,Ae=(r==null?void 0:r.length)??0,Tn=Re+Ae,be=Lt+Re,re=-be,[ms,hs]=I.useState(0),[Pt,ks]=I.useState(0),[Qe,yn]=I.useState(()=>new Map),[P,De]=I.useState(()=>({idx:-1,rowIdx:re-1,mode:"SELECT"})),[Ee,Sn]=I.useState(null),[vn,ws]=I.useState(!1),[He,xs]=I.useState(void 0),At=I.useRef(P),In=I.useRef(He),Ht=I.useRef(-1),Je=I.useRef(null),Rn=I.useRef(!1),[fe,Cs,Dn,En]=ri(),et=Dn-we-Tn*q,Be=b!=null&&m!=null,tt=Mt==="rtl",Bt=tt?"ArrowRight":"ArrowLeft",Nn=tt?"ArrowLeft":"ArrowRight",bs=I.useMemo(()=>({sortStatus:Ye,checkboxFormatter:Xe}),[Ye,Xe]),ps=I.useMemo(()=>{const{length:f}=s;return f!==0&&b!=null&&l!=null&&b.size>=f&&s.every(T=>b.has(l(T)))},[s,b,l]),{columns:ee,colSpanColumns:$n,colOverscanStartIdx:Ts,colOverscanEndIdx:Mn,templateColumns:Ln,layoutCssVars:Pn,columnMetrics:An,lastFrozenColumnIndex:se,totalFrozenColumnWidth:zt,groupBy:Hn}=si({rawColumns:n,columnWidths:Qe,scrollLeft:Pt,viewportWidth:Cs,defaultColumnOptions:y,rawGroupBy:C?g:void 0,enableVirtualization:pn}),{rowOverscanStartIdx:ze,rowOverscanEndIdx:Fe,rows:G,rowsCount:Bn,totalRowHeight:zn,gridTemplateRows:ys,isGroupRow:ce,getRowTop:Ft,getRowHeight:Ot,findRowIdx:Fn}=ii({rawRows:s,groupBy:Hn,rowGrouper:C,rowHeight:ke,clientHeight:et,scrollTop:ms,expandedGroupIds:w,enableVirtualization:pn}),{viewportColumns:pe,flexWidthViewportColumns:Oe}=ci({columns:ee,colSpanColumns:$n,colOverscanStartIdx:Ts,colOverscanEndIdx:Mn,lastFrozenColumnIndex:se,rowOverscanStartIdx:ze,rowOverscanEndIdx:Fe,rows:G,topSummaryRows:o,bottomSummaryRows:r,columnWidths:Qe,isGroupRow:ce}),xe=Hn.length>0&&typeof C=="function",Ss=xe?-1:0,nt=ee.length-1,We=G.length+Ae-1,Wt=rt(P),ot=Gn(P),vs=te(zs),Is=te(x),Rs=te(S),Ds=te(D),Es=te(On),Ns=te(Fs),$s=te(st),Ms=te((f,T,H)=>{const R=G.indexOf(f);Te({rowIdx:R,idx:T.idx},H)}),Ls=te(f=>{Te({rowIdx:f,idx:-1})}),Ps=te(f=>{Te({rowIdx:re,idx:f})}),As=te((f,T)=>{const H=o.indexOf(f);Te({rowIdx:H+re+1,idx:T.idx})}),Hs=te((f,T)=>{const H=r.indexOf(f)+G.length;Te({rowIdx:H,idx:T.idx})}),Bs=te(Wn);pt(()=>{if(!Wt||jt(P,At.current)){At.current=P;return}At.current=P,P.idx===-1&&(Je.current.focus({preventScroll:!0}),rn(Je.current))}),pt(()=>{!En||Oe.length===0||yn(f=>{const T=new Map(f),H=fe.current;for(const R of Oe){const F=H.querySelector(`[data-measuring-cell-key="${R.key}"]`),{width:B}=F.getBoundingClientRect();T.set(R.key,B)}return T})},[En,Oe,fe]),I.useImperativeHandle(t,()=>({element:fe.current,scrollToColumn:_s,scrollToRow(f){const{current:T}=fe;T&&T.scrollTo({top:Ft(f),behavior:"smooth"})},selectCell:Te}));const Kt=I.useCallback(f=>{xs(f),In.current=f},[]);function zs(f,T){const{style:H}=fe.current,R=[...Ln];R[f.idx]=T==="max-content"?T:`${T}px`,H.gridTemplateColumns=R.join(" ");const B=fe.current.querySelector(`[data-measuring-cell-key="${f.key}"]`).getBoundingClientRect().width,W=`${B}px`;if(R[f.idx]!==W&&(R[f.idx]=W,H.gridTemplateColumns=R.join(" ")),Qe.get(f.key)===B)return;const K=new Map(Qe);K.set(f.key,B),yn(K),k==null||k(f.idx,B)}function On({row:f,checked:T,isShiftClick:H}){if(!m)return;qt(l);const R=new Set(b);if(ce(f)){for(const B of f.childRows){const W=l(B);T?R.add(W):R.delete(W)}m(R);return}const F=l(f);if(T){R.add(F);const B=Ht.current,W=G.indexOf(f);if(Ht.current=W,H&&B!==-1&&B!==W){const K=Ja(W-B);for(let V=B+K;V!==W;V+=K){const ne=G[V];ce(ne)||R.add(l(ne))}}}else R.delete(F),Ht.current=-1;m(R)}function Fs(f){if(!m)return;qt(l);const T=new Set(b);for(const H of s){const R=l(H);f?T.add(R):T.delete(R)}m(T)}function Wn(f){if(!h)return;const T=new Set(w);T.has(f)?T.delete(f):T.add(f),h(T)}function Kn(f){if(!(f.target instanceof Element))return;const T=f.target.closest(".rdg-cell")!==null,H=xe&&f.target===Je.current;if(!T&&!H)return;const{key:R,keyCode:F}=f,{rowIdx:B}=P;if(ot&&(A!=null||M!=null)&&lo(f)&&!ce(G[B])&&P.mode==="SELECT"){if(F===67){Ws();return}if(F===86){Ks();return}}if(Un(B)){const W=G[B];if(ce(W)&&P.idx===-1&&(R===Bt&&W.isExpanded||R===Nn&&!W.isExpanded)){f.preventDefault(),Wn(W.id);return}}switch(f.key){case"Escape":Sn(null);return;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"Tab":case"Home":case"End":case"PageUp":case"PageDown":Gs(f);break;default:Vs(f);break}}function Os(f){const{scrollTop:T,scrollLeft:H}=f.currentTarget;yt.flushSync(()=>{hs(T),ks(ei(H))}),N==null||N(f)}function Vt(f){return xe?s.indexOf(G[f]):f}function st(f,T,H){if(typeof i!="function")return;const R=Vt(T);if(H===s[R])return;const F=[...s];F[R]=H,i(F,{indexes:[R],column:f})}function Vn(){P.mode==="EDIT"&&st(ee[P.idx],P.rowIdx,P.row)}function Ws(){const{idx:f,rowIdx:T}=P,H=s[Vt(T)],R=ee[f].key;Sn({row:H,columnKey:R}),M==null||M({sourceRow:H,sourceColumnKey:R})}function Ks(){if(!A||!i||Ee===null||!ct(P))return;const{idx:f,rowIdx:T}=P,H=ee[f],R=s[Vt(T)],F=A({sourceRow:Ee.row,sourceColumnKey:Ee.columnKey,targetRow:R,targetColumnKey:H.key});st(H,T,F)}function Vs(f){var B,W;if(!ot)return;const T=G[P.rowIdx];if(ce(T))return;const{key:H,shiftKey:R}=f;if(Be&&R&&H===" "){qt(l);const K=l(T);On({row:T,checked:!b.has(K),isShiftClick:!1}),f.preventDefault();return}(W=(B=ee[P.idx].editorOptions)==null?void 0:B.onCellKeyDown)==null||W.call(B,f),!f.isDefaultPrevented()&&ct(P)&&Ga(f)&&De(({idx:K,rowIdx:V})=>({idx:K,rowIdx:V,mode:"EDIT",row:T,originalRow:T}))}function _n(f){return f>=Ss&&f<=nt}function Un(f){return f>=0&&f<G.length}function rt({idx:f,rowIdx:T}){return T>=re&&T<=We&&_n(f)}function Gn({idx:f,rowIdx:T}){return Un(T)&&_n(f)}function ct(f){return Gn(f)&&Xa({columns:ee,rows:G,selectedPosition:f,isGroupRow:ce})}function Te(f,T){var H;if(rt(f))if(Vn(),T&&ct(f)){const R=G[f.rowIdx];De({...f,mode:"EDIT",row:R,originalRow:R})}else jt(P,f)?rn((H=fe.current)==null?void 0:H.querySelector('[tabindex="0"]')):De({...f,mode:"SELECT"})}function _s(f){const{current:T}=fe;if(T&&f>se){const{rowIdx:H}=P;if(!rt({rowIdx:H,idx:f}))return;const{clientWidth:R}=T,F=ee[f],{left:B,width:W}=An.get(F);let K=B+W;const V=rs({rows:G,topSummaryRows:o,bottomSummaryRows:r,rowIdx:H,lastFrozenColumnIndex:se,column:F,isGroupRow:ce});if(V!==void 0){const{left:dt,width:Ne}=An.get(ee[F.idx+V-1]);K=dt+Ne}const ne=B<Pt+zt,lt=K>R+Pt,Z=tt?-1:1;ne?T.scrollLeft=(B-zt)*Z:lt&&(T.scrollLeft=(K-R)*Z)}}function Us(f,T,H){const{idx:R,rowIdx:F}=P,B=G[F],W=Wt&&R===-1;if(f===Bt&&W&&ce(B)&&!B.isExpanded&&B.level!==0){let K=-1;for(let V=P.rowIdx-1;V>=0;V--){const ne=G[V];if(ce(ne)&&ne.id===B.parentId){K=V;break}}if(K!==-1)return{idx:R,rowIdx:K}}switch(f){case"ArrowUp":return{idx:R,rowIdx:F-1};case"ArrowDown":return{idx:R,rowIdx:F+1};case Bt:return{idx:R-1,rowIdx:F};case Nn:return{idx:R+1,rowIdx:F};case"Tab":return{idx:R+(H?-1:1),rowIdx:F};case"Home":return W?{idx:R,rowIdx:0}:{idx:0,rowIdx:T?re:F};case"End":return W?{idx:R,rowIdx:G.length-1}:{idx:nt,rowIdx:T?We:F};case"PageUp":{if(P.rowIdx===re)return P;const K=Ft(F)+Ot(F)-et;return{idx:R,rowIdx:K>0?Fn(K):0}}case"PageDown":{if(P.rowIdx>=G.length)return P;const K=Ft(F)+et;return{idx:R,rowIdx:K<zn?Fn(K):G.length-1}}default:return P}}function Gs(f){const{key:T,shiftKey:H}=f;let R=Pe;if(T==="Tab"){if(Qa({shiftKey:H,cellNavigationMode:Pe,maxColIdx:nt,minRowIdx:re,maxRowIdx:We,selectedPosition:P})){Vn();return}R=Pe==="NONE"?"CHANGE_ROW":Pe}f.preventDefault();const F=lo(f),B=Us(T,F,H);if(jt(P,B))return;const W=Za({columns:ee,colSpanColumns:$n,rows:G,topSummaryRows:o,bottomSummaryRows:r,minRowIdx:re,maxRowIdx:We,lastFrozenColumnIndex:se,cellNavigationMode:R,currentPosition:P,nextPosition:B,isCellWithinBounds:rt,isGroupRow:ce});Te(W)}function qs(f){if(He===void 0)return;const{rowIdx:T}=P;return(T<He?T<f&&f<=He:T>f&&f>=He)?P.idx:void 0}function js(){if(Oe.length===0)return Pn;const f=[...Ln];for(const T of Oe)f[T.idx]=T.width;return{...Pn,gridTemplateColumns:f.join(" ")}}function Ys(f){if(!(P.rowIdx!==f||P.mode==="EDIT"||xe||$==null))return c(Zi,{rows:s,columns:ee,selectedPosition:P,isCellEditable:ct,latestDraggedOverRowIdx:In,onRowsChange:i,onFill:$,setDragging:ws,setDraggedOverRowIdx:Kt})}function Xs(f){if(P.rowIdx!==f||P.mode==="SELECT")return;const{idx:T,row:H}=P,R=ee[T],F=ae(R,se,{type:"ROW",row:H}),B=()=>{De(({idx:K,rowIdx:V})=>({idx:K,rowIdx:V,mode:"SELECT"}))},W=(K,V)=>{V?(st(R,P.rowIdx,K),B()):De(ne=>({...ne,row:K}))};return G[P.rowIdx]!==P.originalRow&&B(),c(ji,{column:R,colSpan:F,row:H,skipCellFocusRef:Rn,onRowChange:W,closeEditor:B},R.key)}function at(f){const T=ee[P.idx];return T!==void 0&&P.rowIdx===f&&!pe.includes(T)?P.idx>Mn?[...pe,T]:[...pe.slice(0,se+1),T,...pe.slice(se+1)]:pe}function Zs(){const f=[];let T=0;const{idx:H,rowIdx:R}=P,F=ot&&R<ze?ze-1:ze,B=ot&&R>Fe?Fe+1:Fe;for(let W=F;W<=B;W++){const K=W===ze-1||W===Fe+1,V=K?R:W;let ne=pe;const lt=ee[H];lt!==void 0&&(K?ne=[lt]:ne=at(V));const Z=G[V],dt=be+V+1;if(ce(Z)){({startRowIndex:T}=Z);const ut=Be&&Z.childRows.every(Qs=>b.has(l(Qs)));f.push(c(Hi,{"aria-level":Z.level+1,"aria-setsize":Z.setSize,"aria-posinset":Z.posInSet+1,"aria-rowindex":be+T+1,"aria-selected":Be?ut:void 0,id:Z.id,groupKey:Z.groupKey,viewportColumns:ne,childRows:Z.childRows,rowIdx:V,row:Z,gridRowStart:dt,height:Ot(V),level:Z.level,isExpanded:Z.isExpanded,selectedCellIdx:R===V?H:void 0,isRowSelected:ut,selectGroup:Ls,toggleGroup:Bs},Z.id));continue}T++;let Ne,_t=!1;typeof l=="function"?(Ne=l(Z),_t=(b==null?void 0:b.has(Ne))??!1):Ne=xe?T:V,f.push($t(Ne,{"aria-rowindex":be+(xe?T:V)+1,"aria-selected":Be?_t:void 0,rowIdx:V,row:Z,viewportColumns:ne,isRowSelected:_t,onRowClick:Rs,onRowDoubleClick:Ds,rowClass:U,gridRowStart:dt,height:Ot(V),copiedCellIdx:Ee!==null&&Ee.row===Z?ee.findIndex(ut=>ut.key===Ee.columnKey):void 0,selectedCellIdx:R===V?H:void 0,draggedOverCellIdx:qs(V),setDraggedOverRowIdx:vn?Kt:void 0,lastFrozenColumnIndex:se,onRowChange:$s,selectCell:Ms,selectedCellDragHandle:Ys(V),selectedCellEditor:Xs(V),skipCellFocusRef:Rn}))}return f}(P.idx>nt||P.rowIdx>We)&&(De({idx:-1,rowIdx:re-1,mode:"SELECT"}),Kt(void 0));let it=`${we}px`;Re>0&&(it+=` repeat(${Re}, ${q}px)`),G.length>0&&(it+=ys),Ae>0&&(it+=` repeat(${Ae}, ${q}px)`);const qn=P.idx===-1&&P.rowIdx!==re-1;return z("div",{role:xe?"treegrid":"grid","aria-label":ie,"aria-labelledby":ue,"aria-describedby":Ie,"aria-multiselectable":Be?!0:void 0,"aria-colcount":ee.length,"aria-rowcount":Lt+Bn+Tn,className:Ce(xa,O,vn&&ba),style:{..._,scrollPaddingInlineStart:P.idx>se?`${zt}px`:void 0,scrollPaddingBlock:P.rowIdx>=0&&P.rowIdx<G.length?`${we+Re*q}px ${Ae*q}px`:void 0,gridTemplateRows:it,"--rdg-header-row-height":`${we}px`,"--rdg-summary-row-height":`${q}px`,"--rdg-sign":tt?-1:1,...js()},dir:Mt,ref:fe,onScroll:Os,onKeyDown:Kn,"data-testid":j,children:[xe&&c("div",{ref:Je,tabIndex:qn?0:-1,className:Ce(pa,qn&&[ya,se!==-1&&Sa]),style:{gridRowStart:P.rowIdx+be+1},onKeyDown:Kn}),z(Pa,{value:bs,children:[c(pi,{columns:at(-1),onColumnResize:vs,allRowsSelected:ps,onAllRowsSelectionChange:Ns,sortColumns:d,onSortColumnsChange:Is,lastFrozenColumnIndex:se,selectedCellIdx:P.rowIdx===re?P.idx:void 0,selectCell:Ps,shouldFocusGrid:!Wt,direction:Mt}),G.length===0&&Ze?Ze:z(de,{children:[o==null?void 0:o.map((f,T)=>{const H=Lt+T+1,R=T+re+1,F=P.rowIdx===R,B=we+q*T;return c(fo,{"aria-rowindex":H,rowIdx:T,gridRowStart:H,row:f,top:B,bottom:void 0,lastTopRowIdx:Re-1,viewportColumns:at(R),lastFrozenColumnIndex:se,selectedCellIdx:F?P.idx:void 0,selectCell:As},T)}),c(_a,{value:Es,children:Zs()}),r==null?void 0:r.map((f,T)=>{const H=be+G.length+T+1,R=G.length+T,F=P.rowIdx===R,B=et>zn?Dn-q*(r.length-T):void 0,W=B===void 0?q*(r.length-1-T):void 0;return c(fo,{"aria-rowindex":be+Bn+T+1,rowIdx:T,gridRowStart:H,row:f,top:B,bottom:W,lastTopRowIdx:void 0,viewportColumns:at(R),lastFrozenColumnIndex:se,selectedCellIdx:F?P.idx:void 0,selectCell:Hs},T)})]}),Ya(pe)]})]})}function jt(e,t){return e.idx===t.idx&&e.rowIdx===t.rowIdx}const sl=I.forwardRef(ol),cs=e=>It({type:"track",item:()=>({id:e.track.id,type:e.track.type}),collect:t=>({isDragging:t.isDragging()})}),as=e=>Cn({accept:"track",collect(t){return{id:e.track.id,handlerId:t.getHandlerId()}},drop(t){if(!e.element)return;const n=t.id,s=e.track.id;n!==s&&e.moveTrack({dragId:n,hoverId:s})}}),rl=e=>{const t=e.cell.height<100,n=e.isDragging?"opacity-50":"opacity-100",s="h-full p-2 bg-teal-600",o=`text-white ${t?"text-xs":"text-sm"}`,r="border-b border-b-slate-300",l="bg-gradient-to-r from-sky-700/80 to-emerald-700/50",i="h-full items-center flex",a=`rounded border-2 ${e.isSelected?e.onInstrumentEditor?"border-orange-400":"border-blue-400":"border-emerald-950"}`,u=e.cell.height-55,p=-u*(e.volumePercent/100)+u+15,b=`${e.draggingVolume?"text-emerald-400":"text-white"} transition-colors duration-200`,m=e.volume>-20?c(kr,{className:b}):e.volume>-40?c(wr,{className:b}):c(xr,{className:b}),d=-u*(e.panRightPercent/100)+u+15,x=`${e.draggingPan?"text-teal-400":"text-white"} transition-colors duration-200`,y=c(Cr,{className:x}),g="w-6 h-6 rounded-full text-center",C=Me(["y","u"]),w=C.y,h=C.u,S="border-2 border-rose-500/80",D=e.mute?"bg-rose-500 text-white":w?"bg-rose-400/40 text-shadow":"bg-emerald-600/20",N="border-2 border-yellow-400/80",k=e.solo?"bg-yellow-400 text-white":h?"bg-yellow-400/30 text-shadow":"bg-emerald-600/20",A=`${e.mute?"text-rose-400 font-bold":w?"text-white font-semibold":"text-slate-200 font-normal"} ${w?"text-shadow-lg":""}`,E=`${e.solo?"text-yellow-400 font-bold":h?"text-white font-semibold":"text-slate-200 font-normal"} ${h?"text-shadow-lg":""}`,O=`px-2 border border-orange-400 ${e.onInstrumentEditor?"bg-gradient-to-r from-orange-500 to-orange-500/50 background-pulse":""} `;return{opacity:n,padding:s,text:o,outerBorder:r,gradient:l,innerTrack:i,innerBorder:a,volumeSliderTop:p,panSliderTop:d,VolumeIcon:m,PanIcon:y,audioButton:g,muteBorder:S,muteColor:D,soloBorder:N,soloColor:k,collapsedMuteButton:A,collapsedSoloButton:E,instrumentButton:O}},cl=(e,t)=>{const{selectedTrackId:n}=t,s=t.track,o=!!n&&s.id===n,r=ln(e,s.instrumentId),l=pr(e,s.id),i=Tr(l),{volume:a,pan:u,mute:p,solo:b}=yr(r),m=Ut(a,No,Eo),d=Ut(u,Zt,Xt),x=Ut(u,Xt,Zt),y=dn(e),g=$o(y,"instrument")&&o;return{...t,track:s,instrumentId:s.instrumentId||"",isSelected:o,onInstrumentEditor:g,instrumentName:i,volume:a,volumePercent:m,pan:u,panLeftPercent:d,panRightPercent:x,mute:p,solo:b}},al=(e,t)=>{const n=t.track;return{moveTrack:s=>e(Mc(s)),setTrackName:(s,o)=>{e(yo({id:s.id,name:o}))},setVolume:(s,o)=>{e(wt({instrumentId:s,update:{volume:o}}))},setPan:(s,o)=>{e(wt({instrumentId:s,update:{pan:o}}))},toggleTrackMute:s=>{e(ia(s,n==null?void 0:n.id))},toggleTrackSolo:s=>{e(la(s,n==null?void 0:n.id))},toggleInstrumentEditor:()=>{e(Sr(n==null?void 0:n.id))}}},il=he.connect(cl,al),ll=il(dl);function dl(e){const{track:t,instrumentId:n,cell:s}=e,[o,r]=I.useState(!1),[l,i]=I.useState(!1),a=I.useRef(null),[{},u]=as({...e,element:a.current}),[{isDragging:p},b]=cs({...e,element:a.current});b(u(a));const m=rl({...e,isDragging:p,draggingVolume:o,draggingPan:l}),d=z("div",{className:"w-full flex flex-col space-y-1",children:[c("span",{className:"text-xs text-orange-300 font-nunito"}),c(ls,{id:t.id,cell:e.cell,value:t.name,placeholder:`Pattern Track (${e.label})`,onChange:k=>e.setTrackName(t,k.target.value)})]}),x=z(ds,{children:[c(ge,{content:`${t.collapsed?"Expand ":"Collapse"} Track`,icon:t.collapsed?c(br,{}):c(Yt,{}),onClick:t.collapsed?e.expandTrack:e.collapseTrack}),c(ge,{content:"Copy Track",icon:c(So,{}),onClick:e.duplicateTrack}),c(ge,{content:"Clear Track",icon:c(vo,{}),onClick:e.clearTrack}),c(ge,{content:"Delete Track",icon:c(Io,{}),onClick:e.deleteTrack})]}),y=!!t.collapsed&&z("div",{className:"text-xs -mt-1 space-x-1",children:[c("span",{className:m.collapsedMuteButton,children:"M"}),"•",c("span",{className:m.collapsedSoloButton,children:"S"})]}),g=z("div",{className:"w-full min-h-[2rem] max-h-[3rem] flex flex-1 relative items-center text-sm",draggable:!0,onDragStart:le,children:[d,z("div",{className:"flex flex-col w-12 mr-1 items-end",children:[x,y]})]}),C=()=>c("div",{className:"w-6 h-full z-[90] relative",children:c(go,{className:"h-5 accent-emerald-500",value:e.volume,cell:s,icon:m.VolumeIcon,min:No,max:Eo-Xn,step:Xn,onChange:k=>e.setVolume(n,k.target.valueAsNumber),onDoubleClick:()=>e.setVolume(n,vr),onMouseDown:()=>r(!0),onMouseUp:()=>r(!1),showTooltip:o,tooltipTop:m.volumeSliderTop,tooltipClassName:"bg-emerald-700/80",tooltipContent:`${e.volume.toFixed(0)}dB`})}),w=()=>c("div",{className:"w-6 h-full z-[89] relative",children:c(go,{className:"h-5 accent-teal-400",cell:s,icon:m.PanIcon,value:e.pan,min:Xt,max:Zt,step:Ir,onChange:k=>e.setPan(n,parseFloat(k.target.value)),onDoubleClick:()=>e.setPan(n,Rr),onMouseDown:()=>i(!0),onMouseUp:()=>i(!1),showTooltip:l,tooltipTop:m.panSliderTop,tooltipClassName:"bg-teal-700/80",tooltipContent:`${e.panLeftPercent}L • ${e.panRightPercent}R`})}),h=c(Ro,{show:!t.collapsed,enter:"transition-opacity duration-150",enterFrom:"opacity-0",enterTo:"opacity-100",children:t.collapsed?null:z("div",{className:"flex ml-0.5 mr-1",draggable:!0,onDragStart:le,children:[C(),w()]})}),S=z("div",{className:"w-full flex items-center",draggable:!0,onDragStart:le,children:[z(is,{className:m.instrumentButton,onClick:e.toggleInstrumentEditor,children:[c(Do,{className:"mr-2 flex-shrink-0"}),e.instrumentName]}),z("div",{className:"flex ml-2 space-x-1 justify-self-end",children:[c("button",{className:`${m.audioButton} ${m.muteBorder} ${m.muteColor}`,onClick:e.toggleTrackMute,onDoubleClick:le,children:"M"}),c("button",{className:`${m.audioButton} ${m.soloBorder} ${m.soloColor}`,onClick:e.toggleTrackSolo,onDoubleClick:le,children:"S"})]})]}),D=z("div",{className:`${m.innerTrack} ${m.gradient} ${m.innerBorder}`,onDoubleClick:e.toggleInstrumentEditor,children:[h,z("div",{className:"h-full flex flex-1 flex-col items-start justify-center truncate px-2 duration-150",children:[g,!t.collapsed&&S]})]}),N=`rdg-track ${m.outerBorder} ${m.padding} ${m.text} ${m.opacity}`;return c("div",{className:N,ref:a,onClick:e.selectTrack,children:D})}const ul=e=>{const t=X(Ue),n=X(Mo),s=J(w=>un(w,t)),o=e.track.id===t,r=s.some(({id:w})=>w===e.id),l=e.cell.height<100,i=e.isDragging?"opacity-50":"opacity-100",a=`text-white ${l?"text-xs":"text-sm"}`,u="h-full p-2 bg-indigo-700",p="border-b border-b-slate-300",b="bg-gradient-to-r from-sky-900 to-indigo-800",m="h-full p-2 flex flex-col items-center justify-evenly",d=`rounded border-2 ${o?e.onScaleEditor?"border-sky-500":"border-blue-400":"border-sky-950"}`,x=`w-4 text-center ${r&&n.length?"font-semibold text-fuchsia-400 text-shadow":"font-medium"}`,y=`px-2 border-sky-400 ${e.onScaleEditor?"bg-gradient-to-r from-sky-600 to-sky-600/50 background-pulse":""}`;return{opacity:i,text:a,padding:u,outerBorder:p,gradient:b,innerTrack:m,innerBorder:d,depthLabel:x,scaleEditorButton:y,patternTrackButton:"w-6 h-6 text-2xl flex items-center justify-center border rounded-full border-emerald-500 active:bg-emerald-500 select-none",scaleTrackButton:"w-6 h-6 text-2xl flex items-center justify-center border rounded-full border-indigo-400 active:bg-indigo-500 select-none"}},fl=(e,t)=>{const n=t.track,{selectedTrackId:s}=t,o=s===n.id,r=dn(e),l=o&&$o(r,"scale");return{...t,id:n.id,track:n,isSelected:o,onScaleEditor:l}},gl=(e,t)=>{var s;const n=(s=t.track)==null?void 0:s.id;return{createScaleTrack:()=>{e(vt({parentId:n}))},createPatternTrack:()=>{e(Vo({parentId:n}))},toggleScaleEditor:()=>{e(Nr(n))},setTrackName:o=>{e(To({id:n,name:o}))},moveTrack:o=>e(Lc(o))}},ml=he.connect(fl,gl),hl=ml(kl);function kl(e){const{id:t,track:n}=e,s=_o(),o=X(h=>Dr(h,t,s)),r=Er(o),l=J(h=>an(h,t)),i=l.length&&l.some(h=>h==null?void 0:h.collapsed),a=I.useRef(null),[{},u]=as({...e,element:a.current}),[{isDragging:p},b]=cs({...e,element:a.current});b(u(a));const m=ul({...e,isDragging:p}),d=c(ls,{id:n.id,cell:e.cell,value:n.name,placeholder:`Scale Track (${e.label})`,onChange:h=>e.setTrackName(h.target.value)}),x=z(ds,{children:[c(ge,{content:`${n.collapsed?"Expand ":"Collapse"} Track`,icon:c(Yt,{}),onClick:n.collapsed?e.expandTrack:e.collapseTrack}),c(ge,{content:`${i?"Expand ":"Collapse"} Children`,icon:c(Yt,{}),onClick:i?e.expandChildren:e.collapseChildren}),c(ge,{content:"Copy Track",icon:c(So,{}),onClick:e.duplicateTrack}),c(ge,{content:"Clear Track",icon:c(vo,{}),onClick:e.clearTrack}),c(ge,{content:"Delete Track",icon:c(Io,{}),onClick:e.deleteTrack})]}),y=z("div",{className:"w-full flex relative justify-end",draggable:!0,onDragStart:le,children:[d,c("div",{className:"flex flex-col w-12 mr-1 items-end",children:x})]}),g=()=>z("div",{className:"w-full flex items-center space-x-2 mt-2",draggable:!0,onDragStart:le,children:[z(is,{className:m.scaleEditorButton,onClick:e.toggleScaleEditor,children:[c(Do,{className:"mr-2 flex-shrink-0"}),r]}),z("div",{className:"flex ml-2 space-x-1 justify-self-end",children:[c("button",{className:m.patternTrackButton,children:c(Zn,{onClick:e.createPatternTrack})}),c("button",{className:m.scaleTrackButton,children:c(Zn,{onClick:e.createScaleTrack})})]})]}),C=z("div",{className:`${m.innerTrack} ${m.innerBorder} ${m.gradient}`,onDoubleClick:e.toggleScaleEditor,children:[y,!n.collapsed&&c(g,{})]}),w=`rdg-track ${m.outerBorder} ${m.padding} ${m.text} ${m.opacity}`;return c("div",{className:w,ref:a,onClick:e.selectTrack,children:C})}function wl(e){return e.track?Le(e.track)?c(hl,{...e}):ve(e.track)?c(ll,{...e}):null:null}const is=e=>c("button",{"aria-label":"Track Button",className:`${e.className??""} flex flex-1 items-center rounded-md truncate min-w-6 min-h-[25px] max-h-[30px] m-1 font-light border`,onClick:t=>{var n;(n=e.onClick)==null||n.call(e,t),t.currentTarget.blur()},onDoubleClick:le,children:e.children}),ls=e=>{const n=e.cell.height<100?"text-xs h-6":"text-sm h-7";return c("input",{...e,className:`flex-auto font-nunito ${n} bg-zinc-800 px-1 w-full mr-2 caret-white outline-none focus:ring-0 rounded-md overflow-scroll text-gray-300 border-2 border-zinc-800 focus:border-indigo-500`,onKeyDown:$r})},go=e=>{const{cell:t,icon:n}=e,s=50,o=t.height-s,r=.5*o-10,l="rotate(270deg) translate(30px,0)",i=Ve.omit(e,["cell","icon","showTooltip","tooltipTop","tooltipClassName","tooltipContent"]);return z(de,{children:[z("div",{className:"flex w-8 flex-col items-center text-slate-300",children:[n&&c("span",{className:"text-sm mb-8",children:n}),c("input",{...i,style:{width:o,marginTop:r,transform:l},type:"range",onDoubleClick:a=>{var u;(u=e.onDoubleClick)==null||u.call(e,a),le(a)}})]}),e.showTooltip&&c("div",{style:{top:e.tooltipTop},className:`${e.tooltipClassName??""} absolute left-7 w-16 h-5 flex font-semibold items-center justify-center backdrop-blur border border-slate-300 rounded text-xs`,children:e.tooltipContent})]})},ds=e=>c(kt,{as:"div",className:"relative inline-block focus:ring-0 active:ring-0 focus:border-0 active:border-0",children:({open:t})=>z(de,{children:[c("div",{className:"w-full",children:c(kt.Button,{"aria-label":"Track Dropdown Menu",className:`w-full h-full rounded ${t?"text-indigo-400":"text-white"} outline-none`,children:c(Mr,{className:"text-xl"})})}),c(Ro,{as:I.Fragment,show:t,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:c(kt.Items,{className:"absolute top-0 -right-[13.5rem] w-48 bg-zinc-900/80 backdrop-blur rounded text-md py-2 select-none focus:outline-none",children:e.children})})]})}),ge=e=>c(kt.Item,{children:({active:t})=>z("div",{className:"flex text-left items-center hover:bg-zinc-500/60 cursor-pointer px-4 py-2",onClick:n=>{var s;(s=e.onClick)==null||s.call(e),n.currentTarget.blur()},children:[c("div",{className:"text-xl",children:e.icon}),c("button",{className:`${e.className??""} text-right rounded pl-4 font-light`,children:e.content})]})});function xl(e,t){const{row:n}=t,s=Ue(e),o=me(e,t.row.trackId),r=Lo(e),l=Lr(e,o==null?void 0:o.id),i=Pr(e,o==null?void 0:o.id);return{row:n,selectedTrackId:s,track:o,cell:r,index:l,label:i}}function Cl(e,t){const n=t.row.trackId;return{selectTrack:()=>{e(cn(n))},clearTrack:()=>{e(ea(n))},deleteTrack:()=>{e(Qo(n))},duplicateTrack:()=>{e(ta(n))},collapseTrack:()=>{e(na(n))},expandTrack:()=>{e(sa(n))},collapseChildren:()=>{e(oa(n))},expandChildren:()=>{e(ra(n))}}}const bl=he.connect(xl,Cl),pl=bl(wl);function Tl(e){const{trackId:t,columnIndex:n,row:s}=e;return Cn(()=>({accept:["clip","transposition"],collect:o=>({canDrop:o.canDrop(),isOver:o.isOver()}),hover(o){o.trackId=t,o.canDrop=!0,o.hoveringColumn=n,o.hoveringRow=s.index}}),[t,n,s])}function yl(e){const[{isOver:t,canDrop:n},s]=Tl(e),o=t&&n?"bg-sky-950/30":e.backgroundClass,r=()=>c("div",{className:"w-full h-full bg-transparent",onClick:e.onClick});if(!e.trackId)return c(r,{});const l=`relative text-white w-full h-full ${e.borderClass} ${o}`;return c("div",{ref:s,className:l,onClick:e.onClick,children:c("div",{className:e.cursorClass})})}function Sl(e,t){const n=Number(t.column.key),s=t.row.trackId,o=fn(e),r=Ge(e),l=gn(r),i=mn(r),a=Po(e,n-1),{beats:u,sixteenths:p}=Ao(o,a),b=u===0&&p===0,m=a===Ar.Transport.ticks,d=o.state==="started",x=!l&&!i&&!o.recording&&!d,y=s?me(e,s):void 0,g=!!y&&ve(y),C=r.selectedTrackId===s,w=x&&m&&C,h=l&&g?"animate-pulse cursor-paintbrush bg-sky-400/25 hover:bg-sky-700/50":i&&s?"animate-pulse cursor-wand hover:bg-fuchsia-500/50 bg-fuchsia-500/25":"bg-transparent",S=`border-t border-t-white/20 ${b&&n>1?"border-l-2 border-l-white/20":"border-l-0.5 border-l-slate-700/50"}`,$=`${t.row.type==="patternTrack"?"bg-emerald-500":"bg-sky-500"} ${`animate-pulse transition-all duration-75 ${w?"block":"hidden"} pointer-events-none`} w-[2px] -left-[2px] h-full absolute`;return{...t,columnIndex:n,trackId:s,backgroundClass:h,borderClass:S,showCursor:w,cursorClass:$}}function vl(e,t){const{trackId:n}=t.row,s=Number(t.column.key);return{onClick:()=>{e(Hc(s,n))},setSelectedTrack:o=>{e(cn(o))}}}const Il=he.connect(Sl,vl),Rl=Il(yl);function mo(e){return It(()=>({type:"loop",item:{tick:e.tick-1,hoverIndex:e.tick},collect(t){return{isDragging:t.isDragging()}},end(t){e.onEnd(t)}}),[e.tick])}function Dl(e){return Cn(()=>({accept:"loop",collect:t=>({loopStart:e.loopStart,loopEnd:e.loopEnd,isOver:t.isOver()}),hover:t=>{t.hoverIndex=e.columnIndex}}),[e.loopStart,e.loopEnd])}const El=e=>{const{loop:t,onLoopStart:n,onLoopEnd:s,setLoopStart:o,setLoopEnd:r}=e,{subdivision:l,tick:i,columnIndex:a}=e,[{isOver:u},p]=Dl(e),[b,m]=mo({...e,onEnd:M=>o(M.hoverIndex,l)}),[d,x]=mo({...e,onEnd:M=>r(M.hoverIndex,l)}),y=Me(["s","e"]),g=y.s,C=y.e,w=I.useCallback(()=>{if(t&&g){e.setLoopStart(a,l);return}if(t&&C){e.setLoopEnd(a,l);return}e.onClick(i)},[t,i,a,l,g,C]),h=n?c(ho,{isDragging:b.isDragging,dragRef:m,className:"border-l-8"}):null,S=s?c(ho,{isDragging:d.isDragging,dragRef:x,className:"border-r-8"}):null,D=()=>t?z(de,{children:[h,S]}):null,N=()=>e.isMeasure?c("div",{className:e.measureClass,children:e.bars}):null,$=`rdg-header ${u?"bg-indigo-800":"bg-black"} ${e.className}`;return z("div",{ref:p,className:$,onClick:w,children:[c(D,{}),c(N,{})]})},ho=e=>c("div",{className:`absolute top-0 left-0 w-full h-full border-indigo-700 hover:bg-slate-800 ${e.className??""}`,style:{opacity:e.isDragging?.9:1},ref:e.dragRef});function Nl(e,t){const n=fn(e),{loop:s,loopStart:o,loopEnd:r}=n,{subdivision:l}=Ge(e),i=Qt(l),a=Number(t.column.key),u=Po(e,a-1),{bars:p,beats:b,sixteenths:m}=Ao(n,u),d=b===0&&m===0,x=Ve.inRange(u,o,r),y=o===u,g=r===u+(i-1),w=`${s?y?"pl-3":g?"pr-3":"pl-1":"pl-1"} ${p>99?"text-[9px]":""} select-none`;return{...t,tick:u,columnIndex:a,bars:p,subdivision:l,isMeasure:d,measureClass:w,className:`relative w-full h-full text-white hover:bg-slate-800 cursor-pointer ${`hover:border hover:border-slate-200/80 ${s&&x?"border-b-8 border-b-indigo-700":"border-slate-50/20"}`}`,loop:s,loopStart:o,onLoopStart:y,loopEnd:r,onLoopEnd:g}}function $l(e){return{onClick:t=>{e(Hr(t))},setLoopStart:(t,n)=>{const s=Qt(n)*(t-1);e(Br(s))},setLoopEnd:(t,n)=>{const s=Qt(n)*t;e(zr(s-1))}}}const Ml=he.connect(Nl,$l),Ll=Ml(El);function Pl(e){const{clip:t}=e;return It(()=>({type:"clip",item:()=>(e.onDragStart(),{clip:t}),collect(n){return{isDragging:n.isDragging()}},end:(n,s)=>{n.canDrop&&e.onDragEnd(n,s)}}),[t])}const Al=e=>{const{clip:t,stream:n}=e,s=X(Fr),o=J(Or),r=J(j=>Wr(j,t==null?void 0:t.id)),l=o.some(j=>j===(t==null?void 0:t.id)),i=e.draggingTransposition||e.isTransposing||r.length>0,a=X(j=>Ho(j,t)),u=X(j=>xt(j,t)),p="z-[10] absolute",b=i?u+Jt:u,m=X(j=>hn(j,t==null?void 0:t.tick)),d=X(j=>Kr(j,t==null?void 0:t.id)),x=i?a-Jt:a,y="w-full h-full relative flex flex-col overflow-scroll",{headerColor:g,bodyColor:C,noteColor:w}=Vr(t),h=24,S=Me(["i"]),D=8,N=x-h-D+(S.v?150:0),k=_r(n),$=k.length,M=Math.min(20,N/$),A=Math.min(12,M)-4,v=X(St),L=e.isSlicing?"bg-slate-500/50 group-hover:bg-slate-600/50 border-slate-50/50 hover:border-r-4 cursor-scissors":"border-slate-50/10",E=e.isDragging?"opacity-50":"opacity-100",O=e.isDragging?"pointer-events-none":"",_=`border ${l?"border-white font-bold":"border-slate-200/50 font-medium"} rounded-lg overflow-hidden`,U=(s==null?void 0:s.patternId)!==(t==null?void 0:t.patternId)&&!!(s!=null&&s.patternId),oe=Me(["i"]).i,ie=e.isAdding&&U?"hover:ring-4 hover:ring-teal-500":oe?"hover:ring-4 hover:ring-slate-300":"",ue=e.isAdding?"cursor-paintbrush":oe?"cursor-eyedropper":"cursor-pointer";return{position:p,top:b,left:m,width:d,height:x,headerColor:g,body:y,bodyColor:C,noteColor:w,nameHeight:h,noteHeight:M,chordWidth:v,chordClass:L,fontSize:A,opacity:E,pointerEvents:O,border:_,ring:ie,cursor:ue,getNoteStyles:(j,Q=0)=>{const ke=Ct(j.duration||0,e.subdivision),we=j.MIDI-k[0],q=($-we-1)*M,$t=$===1?(N-M)/2:q+M/2,Ye=Ct(Q,e.subdivision)*v,Xe=ke*v-2,Ze=ye(j.velocity??Ke.DefaultVelocity,Ke.MinVelocity,Ke.MaxVelocity);return{top:$t,left:Ye,width:Xe,height:M,opacity:Ze,border:"border border-slate-950/80 rounded transition-all duration-150"}}}},Hl=(e,t)=>{const n=Ur(e,t.id),s=Gr(e,t.id),o=Ge(e),{subdivision:r,mediaDragState:l}=o,i=gn(o),a=Bo(o),u=mn(o),p=l.draggingTransposition;return{...t,clip:n,name:s,isAdding:i,isSlicing:a,isTransposing:u,subdivision:r,draggingTransposition:p}},Bl=e=>({showPatternEditor:t=>{e(qr({clip:{patternId:t}})),e(zo({id:"patterns"}))},onClick:(t,n,s=!1)=>{e(Bc(t,n,s))},onCut:(t,n)=>{e(zc(t,n))},onDragStart:()=>{e(bt({draggingClip:!0}))},onDragEnd:(t,n)=>{e(Fc(t,n)),e(bt({draggingClip:!1}))}}),zl=he.connect(Hl,Bl),Fl=zl(Ol);function Ol(e){const{clip:t,isSlicing:n}=e,s=Me("i"),o=J(x=>jr(x,t==null?void 0:t.id)),[{isDragging:r},l]=Pl(e),i=Al({...e,stream:o,isDragging:r}),a=(x,y=0,g=0)=>{if(Ke.isRest(x.MIDI))return null;const C=i.getNoteStyles(x,y),w=Ke.toPitch(x.MIDI),h=Ve.pick(C,["top","left","width","height","opacity"]);return c("li",{className:`absolute flex items-center justify-center shrink-0 ${C.border} ${i.noteColor}`,style:h,children:C.width>20&&i.noteHeight>8?w:null},`${x}-${y}-${g}`)},u=(x,y)=>t?c("ul",{className:i.chordClass,style:{width:i.chordWidth},onClick:()=>n&&e.onCut(t,t.tick+y),children:x.map((g,C)=>a(g,y,C))},`${t.id}-chord-${y}`):null,p=c("span",{className:`${i.cursor} ${i.headerColor} flex items-center shrink-0 text-xs text-white/80 p-1 border-b border-b-white/20 whitespace-nowrap overflow-ellipsis select-none`,style:{height:i.nameHeight},children:e.name}),b=I.useMemo(()=>!!o&&c("div",{className:"group w-full h-auto relative flex flex-grow font-extralight text-slate-50/80",children:o.map(u)}),[o,u]),m=`fade-in-100 ${i.position} ${i.cursor} ${i.ring} ${i.opacity} ${i.pointerEvents} ${i.border}`,d=Ve.pick(i,["top","left","width","height","fontSize"]);return c("div",{ref:l,className:m,style:d,onClick:x=>e.onClick(x,t,s.i),onDoubleClick:()=>e.showPatternEditor(t==null?void 0:t.patternId),children:z("div",{className:`${i.body} ${i.bodyColor}`,children:[p,b]})})}function Wl(e){const t=J(Yr),{element:n}=e.timeline;if(!n||!t.length)return null;const s=o=>c(Fl,{id:o},o);return yt.createPortal(t.map(s),n)}function Kl(e){const{transposition:t}=e;return It(()=>({type:"transposition",item:()=>(e.onDragStart(),{transposition:t}),collect(n){return{isDragging:n.isDragging()}},end:(n,s)=>{n.canDrop&&e.onDragEnd(n,s)}}),[t])}var Vl=Xr.GenIcon,_l=function(t){return Vl({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M1020.51 429.376L917.727 275.698l51.152-178.816c3.184-11.216.064-23.28-8.224-31.504-8.256-8.256-20.256-11.311-31.536-8.031l-178.512 52.128L596.319 5.57c-9.712-6.529-22.16-7.313-32.464-1.937-10.369 5.312-17.025 15.871-17.409 27.503l-5.536 185.936-146.496 114.592c-9.183 7.184-13.712 18.816-11.872 30.32s9.808 21.087 20.816 25.023l137.456 49.28c-.928.736-1.904 1.393-2.768 2.257L7.294 969.297c-12.496 12.496-12.496 32.752 0 45.248 6.256 6.256 14.432 9.376 22.624 9.376 8.192 0 16.368-3.12 22.624-9.376l530.752-530.752c2.065-2.064 3.664-4.4 5.04-6.816l53.792 147.552a32.058 32.058 0 0 0 25.152 20.656c1.631.256 3.28.368 4.912.368A32.044 32.044 0 0 0 697.5 633.12l113.776-147.168 183.904-6.56c11.664-.4 22.16-7.12 27.44-17.535 5.264-10.384 4.448-22.848-2.112-32.48zm-226.461-6.83c-9.504.32-18.368 4.882-24.192 12.401l-87.472 113.104-48.976-134.32c-3.248-8.944-10.32-15.936-19.28-19.152l-134.592-48.256 112.624-88.064c7.504-5.872 11.968-14.752 12.288-24.256l4.256-142.944 118.592 79.872a32.192 32.192 0 0 0 26.849 4.191l137.248-40.095-39.344 137.472a32.18 32.18 0 0 0 4.336 26.848l80.56 118.128z"}}]})(t)};const Ul=e=>{const{transposition:t,subdivision:n,cellWidth:s,isSlicing:o}=e,r=(t==null?void 0:t.tick)??0,l=(t==null?void 0:t.duration)??0,i=(t==null?void 0:t.offsets)??{},u=J(Zr).some(q=>q===(t==null?void 0:t.id)),p=J(q=>un(q,e.selectedTrackId)),b=X(q=>Ho(q,t)),m="z-[9] group absolute flex flex-col overflow-hidden",d=X(q=>xt(q,t)),x=X(q=>hn(q,r)),y=X(Qr),g=Ct(1,n)*s,C=l?Ct(l,n)*s:y-x,w=C<2*s,h=Jt,S=`rounded border ${u?"border-white":"border-slate-400"}`,D=`bg-transposition ${o?"opacity-60 group-hover:opacity-90":""}`,N="absolute inset-0 w-full",k=kn(i),$=k>0?Math.min(1,ye(k,1,12)):0,M=k<0?Math.min(1,ye(k,-1,-12)):0,A=Jr(i,p.map(q=>q.id)),v=Math.max(...A),L=Math.min(...A),E=v>0?Math.min(1,ye(v,1,12)):0,O=L<0?Math.min(1,ye(L,-1,-12)):0,_=wn(i),U=_>0?Math.min(1,ye(_,1,12)):0,oe=_<0?Math.min(1,ye(_,-1,-12)):0,ie=e.isDragging?.5:e.draggingClip?.7:1,ue=e.isDragging||e.draggingClip||e.isAdding?"pointer-events-none":"pointer-events-all",Ie="font-light",j=e.isSlicing?"cursor-scissors":"cursor-pointer";return{cellHeight:b,position:m,top:d,left:x,width:C,height:h,isSmall:w,border:S,background:D,tickWidth:g,opacity:ie,pointerEvents:ue,font:Ie,cursor:j,headerDisplay:`w-full flex relative items-center pointer-events-none ${u?"overflow-visible":"overflow-hidden"}`,labelColor:u?"text-white font-bold":"text-white/80 pt-1",hueClass:N,chromaticUpOpacity:$,chromaticDownOpacity:M,chordalUpOpacity:U,chordalDownOpacity:oe,scalarUpOpacity:E,scalarDownOpacity:O,Icon:u?c(_l,{className:"text-md ml-1 mr-2"}):c(ec,{className:"text-md ml-1 mr-2"})}},Gl=(e,t)=>{const n=tc(e,t.id),s=Ue(e),o=St(e),r=Ge(e),{subdivision:l}=r,i=gn(r),a=Bo(r),u=mn(r),{draggingClip:p}=nc(e);return{...t,transposition:n,subdivision:l,isTransposing:u,isAdding:i,isSlicing:a,selectedTrackId:s,cellWidth:o,draggingClip:p}},ql=e=>({onClick:(t,n)=>{e(Oc(t,n))},onDragStart:()=>{e(bt({draggingTransposition:!0}))},onDragEnd:(t,n)=>{e(Wc(t,n)),e(bt({draggingTransposition:!1}))}}),jl=he.connect(Gl,ql),Yl=jl(Xl);function Xl(e){var N;const{transposition:t,isTransposing:n,isSlicing:s}=e,o=J(k=>un(k,t==null?void 0:t.trackId)),[{isDragging:r},l]=Kl(e),i=((N=o.at(-1))==null?void 0:N.id)===(t==null?void 0:t.trackId),a=Ul({...e,isSlicing:s,isTransposing:n,isDragging:r}),u=kn(t==null?void 0:t.offsets),p=wn(t==null?void 0:t.offsets),b=o.map(k=>Fo(t==null?void 0:t.offsets,k==null?void 0:k.id)).slice(0,i?o.length-1:void 0),m=(k,$)=>z("span",{children:[k,$<b.length-1?", ":""]},`${k}-${$}`),d=z("span",{children:["N",u]}),x=z("span",{children:["t",p]}),y=I.useMemo(()=>b.length?z("span",{children:[c("span",{children:"T"}),"(",b.map(m),")"]}):null,[b]),g=()=>z("div",{className:`flex relative h-full items-center whitespace-nowrap z-20 ${a.labelColor}`,draggable:!0,onDragStart:le,children:[a.Icon,a.isSmall?z("div",{className:"absolute flex px-2 border border-slate-200/50 flex-col rounded",style:{top:-(b.length?3:2)*22-5},children:[d,y,x]}):z("div",{className:"flex space-x-1",children:[d,c("span",{children:" • "}),y,b.length?c("span",{children:" • "}):null,x]})]}),C=()=>c("div",{className:`${a.headerDisplay} ${a.background}`,style:{height:a.height},children:c(g,{})}),w=()=>c("div",{className:`w-full h-full ${a.background}`}),h=()=>z("div",{className:"absolute inset-0",children:[c("div",{className:`${a.hueClass} bg-fuchsia-400`,style:{opacity:a.chromaticUpOpacity}}),c("div",{className:`${a.hueClass} bg-fuchsia-700`,style:{opacity:a.chromaticDownOpacity}}),c("div",{className:`${a.hueClass} bg-rose-400`,style:{opacity:a.scalarUpOpacity}}),c("div",{className:`${a.hueClass} bg-rose-600`,style:{opacity:a.scalarDownOpacity}}),c("div",{className:`${a.hueClass} bg-pink-400`,style:{opacity:a.chordalUpOpacity}}),c("div",{className:`${a.hueClass} bg-pink-700`,style:{opacity:a.chordalDownOpacity}})]}),S=`fade-in-100 ${a.position} ${a.border} ${a.font} ${a.cursor} ${a.pointerEvents}`,D=Ve.pick(a,["top","left","width","opacity"]);return z("div",{ref:l,className:S,style:{...D,height:a.cellHeight},onClick:k=>e.onClick(k,t),children:[C(),w(),c(h,{})]})}function Zl(e){const t=J(Mo),{element:n}=e.timeline;if(!n||!t.length)return null;const s=o=>c(Yl,{id:o},o);return yt.createPortal(t.map(s),n)}const Ql=e=>{var y,g;const t=Ue(e),n=oc(e),s=sc(e),o=Oo(e),r=o&&ve(o),l=((y=n==null?void 0:n.clips)==null?void 0:y.length)>0,i=((g=n==null?void 0:n.transpositions)==null?void 0:g.length)>0,a=!l&&!i,{offsets:u}=rc(e),p=kn(u),b=Fo(u,t),m=wn(u),d=e.arrangement.past.length>0,x=e.arrangement.future.length>0;return{areClipsInClipboard:l,areTranspositionsInClipboard:i,isClipboardEmpty:a,canUndo:d,canRedo:x,selectedTrack:o,isPatternTrackSelected:r,selectedPattern:s,chromaticTranspose:p,scalarTranspose:b,chordalTranspose:m}},Jl=e=>({undoArrangement:()=>e({type:Qn.undoArrangement}),redoArrangement:()=>e({type:Qn.redoArrangement}),copyMedia:()=>e(Uo()),cutMedia:()=>e(Go()),pasteMedia:()=>e(qo()),duplicateMedia:()=>e(jo()),deleteMedia:()=>e(Yo()),selectAllMedia:()=>e(Xo()),exportClips:()=>e(Zo()),addPattern:()=>e(Kc()),addPatternTrack:()=>e(Ac()),addScaleTrack:()=>e(vt()),addTransposition:()=>e(Vc()),updateClips:t=>e(cc({clips:t}))}),ed=he.connect(Ql,Jl),td=ed(nd);function nd(e){var O;const t=J(ac),n=J(ic),s=(t==null?void 0:t.length)>0,o=(n==null?void 0:n.length)>0,r=!s&&!o,l=!r,i=!r,a=!e.isClipboardEmpty&&e.selectedTrack&&(Le(e.selectedTrack)?!e.areClipsInClipboard:!0),u=!r&&e.selectedTrack,p=!r,b=s,m=s,d=J(_=>{var U;return lc(_,(U=e.selectedTrack)==null?void 0:U.id)}),x={label:"Undo Last Action",onClick:e.undoArrangement,disabled:!e.canUndo},y={label:"Redo Last Action",onClick:e.redoArrangement,disabled:!e.canRedo,divideEnd:!0},g={label:"Cut Selection",onClick:e.cutMedia,disabled:!l},C={label:"Copy Selection",onClick:e.copyMedia,disabled:!i},w={label:"Paste From Clipboard",onClick:()=>e.pasteMedia(),disabled:!a,divideEnd:!u&&!p&&!b},h={label:"Duplicate Selection",onClick:()=>e.duplicateMedia(),disabled:!u},S={label:"Delete Selection",onClick:e.deleteMedia,disabled:!p},D={label:"Export to MIDI",onClick:e.exportClips,disabled:!b,divideEnd:!0},N={label:"Add Scale Track",onClick:e.addScaleTrack},k={label:"Add Pattern Track",onClick:e.addPatternTrack,disabled:!e.selectedTrack},$={label:`Add ${((O=e.selectedPattern)==null?void 0:O.name)??"New Pattern"}`,onClick:e.addPattern,disabled:!e.isPatternTrackSelected},M={label:`Add ${e.selectedTrack?`(N${e.chromaticTranspose}${e.selectedTrack&&d?`, T${e.scalarTranspose}, `:", "}t${e.chordalTranspose})`:"Transposition"}`,onClick:()=>e.addTransposition(),disabled:!e.selectedTrack,divideEnd:m},A=({color:_})=>{const U=uc[_].iconColor;return c("span",{className:`w-4 h-4 m-1 rounded-full ${U} border cursor-pointer`,onClick:()=>e.updateClips(t.map(oe=>({...oe,color:_})))})},v={label:c("div",{className:"w-32 flex flex-wrap",children:dc.map(_=>c(A,{color:_},_))}),onClick:()=>null,disabled:!m},E=[x,y,l?g:null,i?C:null,a?w:null,u?h:null,p?S:null,b?D:null,N,k,$,M,m?v:null].filter(Boolean);return c(Pc,{targetId:"timeline",options:E})}const od=()=>{const e=X(fn),t=X(St),n=_o(),s=t-4,o=Se,r=-Se,l=X(u=>hn(u,n));return e.state==="started"&&!e.downloading?c("div",{className:"sticky w-full inset-0 z-50 pointer-events-none",style:{height:Se},children:c("div",{className:"relative bg-green-500",style:{height:o,marginTop:r,width:s,left:l}})}):null},sd=I.memo(od),rd=(e,t)=>{const n=gc(),s=St(e),o=fc(e),r=Jn(e).at(-1),l=me(e,r),i=xt(e,l),a=l?l.collapsed?en:o:0,u=Oo(e),p=xt(e,u),b=u?u.collapsed?en:o:0,m=o,d=n*s,x=Jn(e).length,y=Se+o*x;return{...t,cursorHeight:m,width:d,height:y,cellWidth:s,cellHeight:o,tracksHeight:i,lastTrackHeight:a,selectedTrack:u,selectedTrackTop:p,selectedTrackHeight:b}},cd={},ad=he.connect(rd,cd),id=ad(ld);function ld(e){const{timeline:t,width:n,height:s}=e,o=t==null?void 0:t.element,u=c("div",{className:"absolute inset-0 pointer-events-none",style:{height:s,width:n},children:z("div",{className:"relative w-full h-full",children:[c(()=>c("div",{className:"sticky inset-0 -mb-20 z-[90] bg-gradient-to-r from-gray-800 to-gray-900",style:{width:Wo,height:Se}}),{}),c(()=>c("div",{className:"sticky inset-0 z-20 bg-black pointer-events-none",style:{width:n,height:Se}}),{}),c(()=>c("div",{className:"-z-10 absolute inset-0 bg-slate-400/40 flex flex-col pointer-events-none",style:{width:n,height:e.selectedTrackHeight,top:e.selectedTrackTop}}),{}),c(sd,{}),c(()=>c("div",{className:"-z-20 absolute inset-0 flex flex-col",style:{width:n,height:s},children:c("div",{className:"w-full bg-slate-500/80 shadow-xl",style:{height:e.tracksHeight+e.lastTrackHeight}})}),{})]})});return o?yt.createPortal(u,o):null}const Y=Ko("timeline"),ht=Ko("transport");function dd(){const e=xn(),n=X(mc).length;ht("meta+z",()=>e(_c())),ht("meta+shift+z",()=>e(Uc())),ht("space",()=>e(hc())),ht("enter",()=>e(eo())),I.useEffect(()=>()=>e(eo()),[]),Y("l",()=>e(kc())),Y("shift+r",()=>e(wc())),xc("meta+shift+m",()=>e(Sc())),Y("meta+alt+m",()=>e(Cc())),Y("shift+m",()=>e(Zo())),Y("meta+a",()=>e(Xo())),Y("meta+c",()=>e(Uo())),Y("meta+v",()=>e(qo())),Y("meta+x",()=>e(Go())),Y("meta+d",()=>e(jo())),Y("backspace",()=>e(Yo())),Y("p",()=>e(zo({id:"patterns"}))),Y("a",()=>e(Gc())),Y("t",()=>e(qc())),Y("alt+c",()=>e(jc())),Y("alt+m",()=>e(Yc())),Y(["meta+minus"],()=>e(bc())),Y(["meta+="],()=>e(pc())),Y("left",()=>e(n?Xc():Tc()),[n]),Y("right",()=>{e(n?Zc():yc())},[n]),Y("up",()=>e(Qc()),[]),Y("down",()=>e(Jc()),[])}const ud={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,"-":10,"=":11},fd=["z","0"],us={q:-5,w:-4,e:-3,r:-2,t:-1,u:1,i:2,o:3,p:4,"[":5},fs={a:-5,s:-4,d:-3,f:-2,g:-1,j:1,k:2,l:3,";":4,"'":5},gs={z:-5,x:-4,c:-3,v:-2,b:-1,m:1,",":2,".":3,"/":4},$e={chromatic:us,scalar:fs,chordal:gs},gd=["y","h","n","`","0"],md=()=>{to.useHotkeysContext();const e=xn(),t=X(Ge),n=vc(t),r=X(Ic).mode==="numerical",l=J(dn),i=J(Dc),a=J(Ec),u=r?no(ud):no([us,fs,gs]),p=r?fd:gd,b=r?["`","q","w","s","x","e","y","u"]:["`","]","\\","+"],m=["shift","meta",...u,...p,...b],d=Me(m,[m]),x=I.useCallback(w=>{if(Gt(w)||l.show)return;const h=parseInt(w.key);if(isNaN(h))return;const D=i.filter(ve)[h-1],N=D==null?void 0:D.instrumentId;d.y&&e(ft(N)),d.u&&e(gt(N));let k={};const M=d["`"]?-1:1,A=oo(w)?12:0;d.q&&(k._chromatic=(A+h)*M);const v=["w","s","x"];v.forEach(L=>{var U;const E=v.indexOf(L),O=d[L],_=(U=a[E])==null?void 0:U.id;O&&_&&(k[_]=(A+h)*M)}),d.e&&(k._self=(A+h)*M),mt(k)&&e(so(k))},[d,a,ft,gt]),y=I.useCallback(w=>{var N;const h=parseInt(w.key);if(!isNaN(h)){const $=i.filter(ve)[h-1],M=$==null?void 0:$.instrumentId;d["]"]&&e(ft(M)),d["\\"]&&e(gt(M))}let S={},D=oo(w)?5:0;if(w.key in $e.chromatic&&!d.meta&&(S._chromatic=D+$e.chromatic[w.key]),w.key in $e.scalar&&!d.meta){const k=(N=a==null?void 0:a[0])==null?void 0:N.id;k&&(S[k]=D+$e.scalar[w.key])}w.key in $e.chordal&&!d.meta&&(S._self=D+$e.chordal[w.key]),mt(S)&&e(so(S))},[d,a,ft,gt,i]),g=I.useCallback(w=>{var N;const h=w.key;if(!p.includes(h)||Gt(w)||l.show)return;d.y&&e(tn()),d.u&&e(nn());const S={};d.q&&(S._chromatic=0);const D=["w","s","x"];for(const k of D)if(d[k]){const $=(N=a[D.indexOf(k)])==null?void 0:N.id;$&&(S[$]=0)}d.e&&(S._self=0),mt(S)&&e(ro(S))},[d,a]),C=I.useCallback(w=>{var D,N;const h=w.key;if(!p.includes(h)||Gt(w)||l.show)return;le(w),d["]"]&&e(tn()),d["\\"]&&e(nn());const S={};if(h==="y"&&(S._chromatic=0),h==="h"){const k=(D=a==null?void 0:a[0])==null?void 0:D.id;k&&(S[k]=0)}if(h==="n"&&(S._self=0),h==="`"){S._chromatic=0;const k=(N=a==null?void 0:a[0])==null?void 0:N.id;k&&(S[k]=0),S._self=0}mt(S)&&e(ro(S))},[d,a]);I.useEffect(()=>{if(!n)return;const w=r?x:y,h=r?g:C;return window.addEventListener("keydown",w),window.addEventListener("keydown",h),()=>{window.removeEventListener("keydown",w),window.removeEventListener("keydown",h)}},[n,r,x,y,g,C]),to.useHotkeys("shift+t",()=>e(Rc()))};function bd(){const e=xn(),t=X(Lo),n=J($c),s=J(wo),[o,r]=I.useState();dd(),md();const l=I.useCallback(g=>{var h,S;const C=(h=g==null?void 0:g.element)==null?void 0:h.classList[1],w=(S=o==null?void 0:o.element)==null?void 0:S.classList[1];g!==null&&C!==w&&r(g)},[o]),i=I.useMemo(()=>{const g=[],C=n.topLevelIds,w=n.byId,h=D=>{D!=null&&D.length&&D.forEach(N=>{const k=w[N];k&&(g.push({...k,trackId:N,index:S++}),h(k.trackIds))})};let S=0;for(const D of C){const N=w[D];N&&(g.push({...N,trackId:D,index:S++}),h(N.trackIds))}return g.push({index:S++,lastRow:!0,type:"emptyTrack",depth:0}),g},[n]),a=c("div",{className:"rdg-track flex font-nunito w-full h-full justify-center items-center hover:bg-sky-500/30 text-slate-50/0 hover:text-slate-100 ease-in-out transition-all duration-500 rounded cursor-pointer",onClick:()=>e(vt()),children:c("h4",{className:"text-lg font-light",children:"Add a Scale Track"})}),u=I.useMemo(()=>({key:"tracks",name:"Tracks",width:Wo,frozen:!0,formatter:g=>g.row.lastRow?a:g.row.trackId?c(pl,{...g}):null,cellClass(){return"bg-transparent"}}),[]),p=I.useCallback(g=>({key:g,name:g,width:t.width,minWidth:1,formatter(C){return c(Rl,{...C,rows:i})},headerRenderer(C){return c(Ll,{...C})},cellClass(){return"bg-transparent"}}),[i,t.width]),b=I.useMemo(()=>{const g=[],C=Nc*128;for(let w=1;w<=C;w++)g.push(p(w.toString()));return g},[p]),m=I.useMemo(()=>[u,...b],[u,b]),d=I.useCallback(g=>{var C;return g.type!=="ROW"||g.row.trackId===void 0||!((C=s[g.row.trackId])!=null&&C.collapsed)?t.height:en},[t.height,s]),x=I.useMemo(()=>o!=null&&o.element?z(de,{children:[c(id,{timeline:o}),c(Wl,{timeline:o}),c(Zl,{timeline:o})]}):null,[o]),y=I.useMemo(()=>c(sl,{className:"data-grid w-full h-full bg-transparent",ref:l,columns:m,rows:i,rowHeight:d,headerRowHeight:Se,enableVirtualization:!0}),[m,i,d]);return z("div",{id:"timeline",className:"flex flex-col relative w-full h-full",children:[c(td,{}),y,x]})}export{bd as default};
