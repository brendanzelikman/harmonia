import{hx as z,hy as H,e0 as W,fM as q,e6 as J,Y as Z,hz as X,s as B,be as Y,b4 as ee,bf as F,aV as w,bg as te,hA as K,e7 as re,bh as ae,hB as ne,hC as se,r as m,hD as T,bm as oe,bi as k,bv as j,bj as E,hE as ie,bl as y,bn as ue,bo as V,bp as A,bq as D,br as N,hF as _,bu as ce,hG as le,bw as de,hH as pe,hI as fe,hJ as me,bs as I,hK as P,bt as ve,hL as L,hM as he,hN as Q,hO as G,hP as Ie,hQ as be}from"./index-fe048463.js";const Ne=(e=W)=>async i=>new Promise(o=>{const r=z(e);i(H(r)),o(r.id)}),Oe=e=>(i,o)=>{const r=o(),{patternId:a}=q(r),n=J(r),s=n.findIndex(t=>t===e);if(s!==-1){if(a===e){const t=(n==null?void 0:n[s-1])||(n==null?void 0:n[s+1]);t&&i(Z({clip:{patternId:t}}))}i(X(e))}},Ue=e=>(i,o)=>{if(!e)return;const r=o(),a=B(r),n=Y.global;if(!n.isLoaded())return;const s=ee(e);if(!s.length)return;n.solo=!0;let t=0;for(let c=0;c<s.length;c++){const l=s[c];if(!l.length)continue;const f=l[0],d=F(a,f.duration);if(w.isRest(l)){t+=d;continue}const v=te(f.duration),b=l.map(g=>w.toPitch(g.MIDI));setTimeout(()=>{n.isLoaded()&&n.sampler.triggerAttackRelease(b,v)},t*1e3),t+=d}setTimeout(()=>{n.solo=!1},t*1e3)},ge=e=>{const i="([A-Ga-g][#|b]?)?",o=ne.filter(a=>{const t=[a.id,...a.aliases||[]].map(l=>l.replace("+","\\+")).join("|");return new RegExp(`^${i} ?(${t})$`).test(e)});if(!o.length)return;let r=[];for(const a of[o[0]]){const t=[a.id,...a.aliases||[]].map(b=>b.replace("+","\\+")).join("|"),l=new RegExp(`^${i} ?(${t})$`).exec(e);if(!l)continue;const f=(l[1]||"C").toUpperCase(),d=w.ChromaticNumber(f),v=se(a.stream,d);r.push(...v)}return r},je=(e,i)=>(o,r)=>{const a=r(),n=K(a,e),s=ge(i);if(!n||!(s!=null&&s.length))return;const t={...n,stream:[...n.stream,...s]};o(re(t))},Qe=e=>(i,o)=>{const r=o(),a=B(r),n=K(r,e);if(!n)return;const s=new ae.Midi,t=s.addTrack(),c=n.stream;let l=0;for(let b=0;b<c.length;b++){const g=c[b];if(!g.length)continue;const p=g[0],x=F(a,p.duration);if(l+=x,w.isRest(g))continue;const S=F(a,l);for(const u of g)t.addNote({midi:u.MIDI,duration:x,time:S,velocity:u.velocity})}const f=new Blob([s.toArray()],{type:"audio/midi"}),d=URL.createObjectURL(f),v=document.createElement("a");v.href=d,v.download=`${n.name||"pattern"}.mid`,v.click(),URL.revokeObjectURL(d)};function ye({container:e,accept:i,walk:o,enabled:r=!0}){let a=m.useRef(i),n=m.useRef(o);m.useEffect(()=>{a.current=i,n.current=o},[i,o]),T(()=>{if(!e||!r)return;let s=oe(e);if(!s)return;let t=a.current,c=n.current,l=Object.assign(d=>t(d),{acceptNode:t}),f=s.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,l,!1);for(;f.nextNode();)c(f.currentNode)},[e,r,a,n])}var Re=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Re||{}),xe=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(xe||{}),Pe=(e=>(e[e.OpenMenu=0]="OpenMenu",e[e.CloseMenu=1]="CloseMenu",e[e.GoToItem=2]="GoToItem",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterItem=5]="RegisterItem",e[e.UnregisterItem=6]="UnregisterItem",e))(Pe||{});function $(e,i=o=>o){let o=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,r=be(i(e.items.slice()),n=>n.dataRef.current.domRef.current),a=o?r.indexOf(o):null;return a===-1&&(a=null),{items:r,activeItemIndex:a}}let Se={1(e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},0(e){return e.menuState===0?e:{...e,menuState:0}},2:(e,i)=>{var o;let r=$(e),a=Ie(i,{resolveItems:()=>r.items,resolveActiveIndex:()=>r.activeItemIndex,resolveId:n=>n.id,resolveDisabled:n=>n.dataRef.current.disabled});return{...e,...r,searchQuery:"",activeItemIndex:a,activationTrigger:(o=i.trigger)!=null?o:1}},3:(e,i)=>{let o=e.searchQuery!==""?0:1,r=e.searchQuery+i.value.toLowerCase(),a=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+o).concat(e.items.slice(0,e.activeItemIndex+o)):e.items).find(s=>{var t;return((t=s.dataRef.current.textValue)==null?void 0:t.startsWith(r))&&!s.dataRef.current.disabled}),n=a?e.items.indexOf(a):-1;return n===-1||n===e.activeItemIndex?{...e,searchQuery:r}:{...e,searchQuery:r,activeItemIndex:n,activationTrigger:1}},4(e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},5:(e,i)=>{let o=$(e,r=>[...r,{id:i.id,dataRef:i.dataRef}]);return{...e,...o}},6:(e,i)=>{let o=$(e,r=>{let a=r.findIndex(n=>n.id===i.id);return a!==-1&&r.splice(a,1),r});return{...e,...o,activationTrigger:1}}},O=m.createContext(null);O.displayName="MenuContext";function C(e){let i=m.useContext(O);if(i===null){let o=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,C),o}return i}function Te(e,i){return V(i.type,Se,e,i)}let Me=m.Fragment,we=k(function(e,i){let o=m.useReducer(Te,{menuState:1,buttonRef:m.createRef(),itemsRef:m.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:r,itemsRef:a,buttonRef:n},s]=o,t=E(i);ie([n,a],(v,b)=>{var g;s({type:1}),fe(b,me.Loose)||(v.preventDefault(),(g=n.current)==null||g.focus())},r===0);let c=y(()=>{s({type:1})}),l=m.useMemo(()=>({open:r===0,close:c}),[r,c]),f=e,d={ref:t};return m.createElement(O.Provider,{value:o},m.createElement(ue,{value:V(r,{0:A.Open,1:A.Closed})},D({ourProps:d,theirProps:f,slot:l,defaultTag:Me,name:"Menu"})))}),ke="button",Ee=k(function(e,i){var o;let r=N(),{id:a=`headlessui-menu-button-${r}`,...n}=e,[s,t]=C("Menu.Button"),c=E(s.buttonRef,i),l=_(),f=y(p=>{switch(p.key){case I.Space:case I.Enter:case I.ArrowDown:p.preventDefault(),p.stopPropagation(),t({type:0}),l.nextFrame(()=>t({type:2,focus:P.First}));break;case I.ArrowUp:p.preventDefault(),p.stopPropagation(),t({type:0}),l.nextFrame(()=>t({type:2,focus:P.Last}));break}}),d=y(p=>{switch(p.key){case I.Space:p.preventDefault();break}}),v=y(p=>{if(ve(p.currentTarget))return p.preventDefault();e.disabled||(s.menuState===0?(t({type:1}),l.nextFrame(()=>{var x;return(x=s.buttonRef.current)==null?void 0:x.focus({preventScroll:!0})})):(p.preventDefault(),t({type:0})))}),b=m.useMemo(()=>({open:s.menuState===0}),[s]),g={ref:c,id:a,type:ce(e,s.buttonRef),"aria-haspopup":"menu","aria-controls":(o=s.itemsRef.current)==null?void 0:o.id,"aria-expanded":e.disabled?void 0:s.menuState===0,onKeyDown:f,onKeyUp:d,onClick:v};return D({ourProps:g,theirProps:n,slot:b,defaultTag:ke,name:"Menu.Button"})}),De="div",Ce=j.RenderStrategy|j.Static,$e=k(function(e,i){var o,r;let a=N(),{id:n=`headlessui-menu-items-${a}`,...s}=e,[t,c]=C("Menu.Items"),l=E(t.itemsRef,i),f=le(t.itemsRef),d=_(),v=de(),b=(()=>v!==null?v===A.Open:t.menuState===0)();m.useEffect(()=>{let u=t.itemsRef.current;!u||t.menuState===0&&u!==(f==null?void 0:f.activeElement)&&u.focus({preventScroll:!0})},[t.menuState,t.itemsRef,f]),ye({container:t.itemsRef.current,enabled:t.menuState===0,accept(u){return u.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:u.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(u){u.setAttribute("role","none")}});let g=y(u=>{var M,h;switch(d.dispose(),u.key){case I.Space:if(t.searchQuery!=="")return u.preventDefault(),u.stopPropagation(),c({type:3,value:u.key});case I.Enter:if(u.preventDefault(),u.stopPropagation(),c({type:1}),t.activeItemIndex!==null){let{dataRef:R}=t.items[t.activeItemIndex];(h=(M=R.current)==null?void 0:M.domRef.current)==null||h.click()}G(t.buttonRef.current);break;case I.ArrowDown:return u.preventDefault(),u.stopPropagation(),c({type:2,focus:P.Next});case I.ArrowUp:return u.preventDefault(),u.stopPropagation(),c({type:2,focus:P.Previous});case I.Home:case I.PageUp:return u.preventDefault(),u.stopPropagation(),c({type:2,focus:P.First});case I.End:case I.PageDown:return u.preventDefault(),u.stopPropagation(),c({type:2,focus:P.Last});case I.Escape:u.preventDefault(),u.stopPropagation(),c({type:1}),L().nextFrame(()=>{var R;return(R=t.buttonRef.current)==null?void 0:R.focus({preventScroll:!0})});break;case I.Tab:u.preventDefault(),u.stopPropagation(),c({type:1}),L().nextFrame(()=>{he(t.buttonRef.current,u.shiftKey?Q.Previous:Q.Next)});break;default:u.key.length===1&&(c({type:3,value:u.key}),d.setTimeout(()=>c({type:4}),350));break}}),p=y(u=>{switch(u.key){case I.Space:u.preventDefault();break}}),x=m.useMemo(()=>({open:t.menuState===0}),[t]),S={"aria-activedescendant":t.activeItemIndex===null||(o=t.items[t.activeItemIndex])==null?void 0:o.id,"aria-labelledby":(r=t.buttonRef.current)==null?void 0:r.id,id:n,onKeyDown:g,onKeyUp:p,role:"menu",tabIndex:0,ref:l};return D({ourProps:S,theirProps:s,slot:x,defaultTag:De,features:Ce,visible:b,name:"Menu.Items"})}),Fe=m.Fragment,Ae=k(function(e,i){let o=N(),{id:r=`headlessui-menu-item-${o}`,disabled:a=!1,...n}=e,[s,t]=C("Menu.Item"),c=s.activeItemIndex!==null?s.items[s.activeItemIndex].id===r:!1,l=m.useRef(null),f=E(i,l);T(()=>{if(s.menuState!==0||!c||s.activationTrigger===0)return;let h=L();return h.requestAnimationFrame(()=>{var R,U;(U=(R=l.current)==null?void 0:R.scrollIntoView)==null||U.call(R,{block:"nearest"})}),h.dispose},[l,c,s.menuState,s.activationTrigger,s.activeItemIndex]);let d=m.useRef({disabled:a,domRef:l});T(()=>{d.current.disabled=a},[d,a]),T(()=>{var h,R;d.current.textValue=(R=(h=l.current)==null?void 0:h.textContent)==null?void 0:R.toLowerCase()},[d,l]),T(()=>(t({type:5,id:r,dataRef:d}),()=>t({type:6,id:r})),[d,r]);let v=y(()=>{t({type:1})}),b=y(h=>{if(a)return h.preventDefault();t({type:1}),G(s.buttonRef.current)}),g=y(()=>{if(a)return t({type:2,focus:P.Nothing});t({type:2,focus:P.Specific,id:r})}),p=pe(),x=y(h=>p.update(h)),S=y(h=>{!p.wasMoved(h)||a||c||t({type:2,focus:P.Specific,id:r,trigger:0})}),u=y(h=>{!p.wasMoved(h)||a||!c||t({type:2,focus:P.Nothing})}),M=m.useMemo(()=>({active:c,disabled:a,close:v}),[c,a,v]);return D({ourProps:{id:r,ref:f,role:"menuitem",tabIndex:a===!0?void 0:-1,"aria-disabled":a===!0?!0:void 0,disabled:void 0,onClick:b,onFocus:g,onPointerEnter:x,onMouseEnter:x,onPointerMove:S,onMouseMove:S,onPointerLeave:u,onMouseLeave:u},theirProps:n,slot:M,defaultTag:Fe,name:"Menu.Item"})}),Be=Object.assign(we,{Button:Ee,Items:$e,Item:Ae});export{Be as Z,Ne as c,Oe as d,Qe as e,Ue as p,je as u};
