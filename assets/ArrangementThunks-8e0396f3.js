import{g0 as xt,fz as Dt,gA as m,ga as E,ah as A,gB as ct,gg as R,dC as B,g8 as Ot,gC as Pt,gD as Et,T as V,fb as At,gE as bt,gF as H,gG as L,gH as Y,gI as G,gJ as Rt,gK as rt,gL as z,gM as U,gN as _t,gO as Bt,gP as Ht,gQ as Lt,gR as Nt,aK as D,gS as Wt,gT as Ft,gU as Kt,av as at,fY as zt,g6 as Ut,gV as Vt,gW as Yt,gX as Gt,gY as Xt,g9 as dt,gZ as qt,f7 as Jt,g_ as Qt,g$ as Zt,h0 as $t,a6 as ts,a7 as ss,h1 as es,aV as ns,Y as lt,h2 as X,w as N,a0 as O,a1 as q,es as P,ao as W,a3 as pt,ar as ft,at as os,h3 as ut,f8 as J,au as gt,h4 as is,fG as cs,fI as ot,e_ as Q,fd as rs,h5 as Tt,gt as It,fg as kt,h6 as mt,h7 as it,h8 as Mt,h9 as Ct,ha as as,hb as wt,fV as ds,g1 as ls,fW as Z,gi as ps,hc as fs,fL as St,fM as us,a4 as gs,r as Ts,hd as Is,he as ks,hf as ms,et as yt}from"./index-fe048463.js";import{c as Ms}from"./menu-4bb74a08.js";const F=({clips:e,transpositions:s})=>t=>new Promise(n=>{const o=(e||[]).map(z),i=(s||[]).map(U),a={clips:o,transpositions:i};t(_t(a)),t(Bt(a)),t(Ht(a));const c=o.map(p=>p.id),l=i.map(p=>p.id);n({clipIds:c,transpositionIds:l})}),$=e=>s=>new Promise(t=>{s(dt(e)),s(qt(e));const n=e.clips||[],o=e.transpositions||[],i=n.map(l=>l.id),a=o.map(l=>l.id);t({clipIds:i,transpositionIds:a})}),tt=(e,s)=>(t,n)=>{const o=n(),i=Y(o);return new Promise(a=>{e.some(c=>!Lt(c))&&a(!1),s.some(c=>!Nt(c))&&a(!1),t(m({clipIds:D.without(i.clipIds,...e.map(c=>c.id)),transpositionIds:D.without(i.transpositionIds,...s.map(c=>c.id))})),t(Wt({clips:e,transpositions:s})),t(Ft({transpositions:s})),t(Kt({clips:e,transpositions:s})),a(!0)})},ys=()=>(e,s)=>{const t=s(),n=xt(t),o=Dt(t);e(m({clipIds:n,transpositionIds:o}))},hs=()=>(e,s)=>{const t=s(),n=E(t),o=A(t);e(ct({clips:n,transpositions:o}))},vs=()=>(e,s)=>{const t=s(),n=E(t),o=A(t);e(ct({clips:n,transpositions:o})),e(tt(n,o))},js=()=>(e,s)=>{const t=s(),n=Promise.resolve({clipIds:[],transpositionIds:[]}),o=R(t);if(!(o!=null&&o.length))return n;const i=B(t);if(!i)return n;const a=Ot(t),c=Pt(a);if(!(c!=null&&c.length))return n;const l=Et(c,V.Transport.ticks,i,o),d=At(t),p=bt(l,d);if(p.length!==l.length)return n;const g=H(p),f=L(p);return e(F({clips:g,transpositions:f})).then(I=>e(m(I)))},xs=()=>async(e,s)=>{const t=s(),{clipIds:n,transpositionIds:o}=Y(t);if(!n.length&&!o.length)return;const i=E(t),a=i.map(u=>G(t,u.id)),c=A(t),l=c.map(u=>u.duration||1),d=[...i,...c],p=[...a,...l],g=Rt(d,p),f=H(g),w=L(g);e(F({clips:f,transpositions:w})).then(u=>e(m(u)))},ht=e=>(s,t)=>{if(!e)return;const n=t(),i=at(n).map(d=>({...d,tick:d.tick+e}));if(i.some(d=>d.tick<0))return;const a=H(i),c=L(i);s($({clips:a,transpositions:c}))},Ds=()=>(e,s)=>{const t=s(),n=rt(t);e(ht(-n))},Os=()=>(e,s)=>{const t=s(),n=rt(t);e(ht(n))},Ps=()=>(e,s)=>{const t=s(),n=E(t),o=A(t);e(tt(n,o))},Cs=(e,s=0)=>(t,n)=>{if(!e||s<0)return;const o=n(),{clipIds:i,transpositionIds:a}=Y(o),c=zt(o,e.id),l=Ut(o,e.id);if(!c&&!l)return;const d=c||l,p=!!c,g=Vt([d],p?[G(o,d.id)]:[]),f=s-d.tick;if(s===d.tick||f===g||f<0||p&&f>e.tick+g)return;const w=p?z({...c,duration:f}):U({...l,duration:f}),I=p?z({...c,tick:s,offset:c.offset+f,duration:g-f}):U({...l,tick:s,duration:d.duration?g-f:0});if(t(p?m({clipIds:D.without(i,d.id)}):m({transpositionIds:D.without(a,d.id)})),p){if(!c)return;t(Yt({oldClip:c,firstClip:w,secondClip:I}))}else{if(!l)return;t(Gt({oldTransposition:l,firstTransposition:w,secondTransposition:I}))}const u={oldId:d.id,newIds:[w.id,I.id]};t(Xt(u))},Es=(e={})=>async(s,t)=>{const n=t();if(!at(n).length)return;const i=Jt(n),a=Qt(n),c=Zt(n),l=$t(n),d=ts(n),p=ss(n),g=E(n),f=A(n),w=[],I=g.sort((T,M)=>T.tick-M.tick),u=I.reduce((T,M)=>{const C=a[M.patternId];if(!C)return T;w.push(C.name);const k=G(n,M.id);let _=es({clip:M,patternMap:a,patternTrackMap:l,scaleMap:d,scaleTrackMap:p,transpositionMap:c,trackNodeMap:i}),b=0;return _=_.reduce((y,K)=>{if(b>k)return y;const st=K[0];if(!st)return y;const et=st.duration;if(b+et>k){const nt=k-b,vt=K.map(jt=>({...jt,duration:nt}));return b+=nt,[...y,vt]}return b+=et,[...y,K]},[]),_.length||(_=[[{duration:k,MIDI:ns.Rest,velocity:0}]]),[...T,..._]},[]),h=(e==null?void 0:e.name)||w.join(" + "),S=await s(Ms({stream:u,name:h}));lt({clip:{patternId:S}});const{trackId:x,tick:v}=I[0];await s(X([{trackId:x,patternId:S,tick:v}])),s(tt(g,f))},As=()=>(e,s)=>{const t=s(),n=N(t),o=O(t);q(o)?e(P("idle")):(e(P("addingClips")),n.show&&e(W()))},bs=()=>(e,s)=>{const t=s(),n=N(t),o=O(t);pt(o)?e(P("idle")):(e(P("addingTranspositions")),n.show&&e(W()))},Rs=()=>(e,s)=>{const t=s(),n=N(t),o=O(t);ft(o)?e(P("idle")):(e(P("slicingMedia")),n.show&&e(W()))},_s=()=>(e,s)=>{const t=s(),n=N(t),o=O(t);os(o)?e(P("idle")):(e(P("mergingMedia")),n.show&&e(W()))},Bs=(e,s)=>(t,n)=>{const o=n(),i=cs(o,e-1);if(s===void 0){t(ot(i)),t(m({clipIds:[],transpositionIds:[]}));return}const a=O(o),{mediaDraft:c}=a,l=Q(o,s),d=!!l&&rs(l);if(q(a)){if(!d)return;const{patternId:p}=c.clip;if(!p)return;const g={...c.clip,patternId:p,trackId:s,tick:i};t(X([g]));return}if(pt(a)){const p={...c.transposition,trackId:s,tick:i};t(Tt([p]));return}t(ot(i)),s&&t(J(s)),t(m({clipIds:[],transpositionIds:[]}))},Hs=(e,s,t=!1)=>(n,o)=>{if(!s)return;const i=o(),a=O(i),{mediaSelection:c,mediaDraft:l}=a,d=gt(i),p=l.clip.patternId;if(t){n(lt({clip:{patternId:p}}));return}if(q(a)&&p){n(dt({clips:[{...s,patternId:p}]}));return}if(c.clipIds.includes(s.id)){n(m({clipIds:D.without(d,s.id)}));return}const f=e.nativeEvent;if(!It(f)){const y=kt(f);n(y?m({clipIds:D.union(d,[s.id])}):m({clipIds:[s.id]}));return}if(!c.clipIds){n(m({clipIds:[s.id]}));return}const I=E(i),u=D.union(I,[s]),h=u.map(y=>y.id),j=mt(u),S=it(i,h),x=Mt(u,S),v=R(i),r=Ct(I,v,s.trackId),T=as(i,r),M=T.map(y=>y.id),C=it(i,M),k=wt(T,j,x,C),b=H(k).map(y=>y.id);n(m({clipIds:b}))},Ls=(e,s)=>(t,n)=>{if(!s)return;const o=n(),i=O(o),a=ds(o),c=ls(o),l=A(o),d=e.nativeEvent;if(ft(i)){if(!e.currentTarget.offsetParent)return;const T=Z(1,i.subdivision),M=a*T,C=e.clientX-ps,k=Math.round(C/M);t(Cs(s,k));return}if(l.some(r=>r.id===s.id)){t(m({transpositionIds:D.without(c,s.id)}));return}if(!It(d)){const r=kt(d);t(r?m({transpositionIds:D.union(c,[s.id])}):m({transpositionIds:[s.id]}));return}if(l.length===0){t(m({transpositionIds:[s.id]}));return}const f=D.union(l,[s]),w=mt(f),I=Mt(f),u=R(o),h=Ct(l,u,s.trackId),j=fs(o,h),S=wt(j,w,I),v=L(S).map(r=>r.id);t(m({transpositionIds:v}))},Ns=(e,s)=>(t,n)=>{const o=n(),i=R(o),{subdivision:a}=O(o),c=E(o),l=A(o),d=e.clip,p=i.indexOf(d.trackId);if(p===-1)return;const g=e.hoveringRow-p,f=Z(d.tick,a),I=(e.hoveringColumn-f-1)*St(a),u=s.getDropResult(),h=(u==null?void 0:u.dropEffect)==="copy",j=d?c.includes(d)?c:[d]:[],S=[],x=[];for(const r of j){const T=i.indexOf(r==null?void 0:r.trackId);if(!r||T===-1)return;const M=T+g,C=i[M],k=Q(o,C);if(!(k!=null&&k.id)||k.type!=="patternTrack")return;S.push({...r,trackId:k.id,tick:r.tick+I})}for(const r of l){if(!r)return;const T=i.indexOf(r.trackId);if(T===-1)return;const M=T+g,C=i[M];x.push({...r,trackId:C,tick:r.tick+I})}if(S.some(({tick:r})=>r<0)||x.some(({tick:r})=>r<0))return;const v={clips:S,transpositions:x};if(!h){t($(v));return}t(F(v)).then(r=>t(m(r)))},Ws=(e,s)=>(t,n)=>{const o=n(),i=R(o),{subdivision:a}=O(o),c=E(o),l=A(o),d=e.transposition,p=i.indexOf(d.trackId);if(p===-1)return;const g=e.hoveringRow-p,f=Z(d.tick,a),I=(e.hoveringColumn-f-1)*St(a),u=s.getDropResult(),h=(u==null?void 0:u.dropEffect)==="copy";let j=[],S=[];for(const r of c){const T=i.indexOf(r==null?void 0:r.trackId);if(!r||T===-1)return;const M=T+g,C=i[M],k=Q(o,C);if(!(k!=null&&k.id)||k.type!=="patternTrack")return;j.push({...r,trackId:k.id,tick:r.tick+I})}const x=l.includes(d)?l:[d];for(const r of x){const T=i.indexOf(r==null?void 0:r.trackId);if(!r||T===-1)return;const M=T+g,C=i[M];if(!C)return;S.push({...r,trackId:C,tick:r.tick+I})}if(j.some(({tick:r})=>r<0)||S.some(({tick:r})=>r<0))return;const v={clips:j,transpositions:S};if(!h){t($(v));return}t(F(v)).then(r=>t(m(r)))},Fs=()=>(e,s)=>{const t=s();if(!B(t))return;const i={...us(t),tick:V.Transport.ticks};e(X([i]))},Ks=()=>(e,s)=>{const t=s();if(!B(t))return;const i={...gs(t),tick:V.Transport.ticks};e(Tt([i]))},zs=()=>(e,s)=>{const t=s(),n=B(t);if(!n)return;const o=R(t),i=o.length,a=o.indexOf(n),c=o[ut(a-1,i)];e(J(c))},Us=()=>(e,s)=>{const t=s(),n=B(t);if(!n)return;const o=R(t),i=o.length,a=o.indexOf(n),c=o[ut(a+1,i)];e(J(c))},Vs=()=>(e,s)=>{const t=s(),n=gt(t);e(is(n))};function Ys(e){const[s,t]=Ts.useState(0),n=e!=null&&e.offline?Is:ks;return ms(n,o=>t(o.detail)),s}const Gs=()=>(e,s)=>{const t=s(),{past:n}=t.arrangement;n.length>0&&e({type:yt.undoArrangement})},Xs=()=>(e,s)=>{const t=s(),{future:n}=t.arrangement;n.length>0&&e({type:yt.redoArrangement})};export{zs as A,Us as B,Gs as a,bs as b,Rs as c,_s as d,F as e,Hs as f,Ns as g,Ls as h,Ws as i,hs as j,vs as k,xs as l,Es as m,Ps as n,Bs as o,js as p,ys as q,Xs as r,Cs as s,As as t,Ys as u,Vs as v,Fs as w,Ks as x,Ds as y,Os as z};
